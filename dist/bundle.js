(()=>{"use strict";class t{constructor(t=0,e=0){this._x=t,this._y=e}get x(){return this._x}set x(t){this._x=t}get y(){return this._y}set y(t){this._y=t}get magnitude(){return Math.sqrt(Math.pow(this._x,2)+Math.pow(this._y,2))}set(t,e){this._x=t,this._y=e}copy(t){this.set(t.x,t.y)}equals(t){return this._x===t.x&&this._y===t.y}clone(){return new t(this._x,this._y)}distance(t){return Math.sqrt(Math.pow(this._x-t.x,2)+Math.pow(this._y-t.y,2))}static add(t,e,i){return t.set(e.x+i.x,e.y+i.y),t}static subtract(t,e,i){return t.set(e.x-i.x,e.y-i.y),t}static unit(t,e){return 0===e.magnitude?t.set(0,0):t.set(e.x/e.magnitude,e.y/e.magnitude),t}static normal(t,e){return t.set(-e.y,e.x),this.unit(t,t)}static scale(t,e,i){return t.set(e.x*i,e.y*i),t}static dot(t,e){return t.x*e.x+t.y*e.y}static cross(t,e){return t.x*e.y-t.y*e.x}static round(t,e){return t.set(Math.round(e.x),Math.round(e.y)),t}}class e{constructor(e,i,s,n){this._position=new t,this._center=new t,this._width=0,this._height=0,this.set(e,i,s,n)}get x(){return this._position.x}set x(t){this._position.set(t,this._position.y)}get y(){return this._position.y}set y(t){this._position.set(this._position.x,t)}get x1(){return this._position.x+this._width}get y1(){return this._position.y+this._height}get position(){return this._position}set position(t){this._position.set(t.x,t.y)}get width(){return this._width}set width(t){this._width=t}get height(){return this._height}set height(t){this._height=t}get center(){return this._center.set(this.x+this.width/2,this.y+this.height/2),this._center}set(t,e,i,s){this._position.set(t,e),this._width=i,this._height=s}equals(t){return this.position.equals(t.position)&&this.width===t.width&&this.height===t.height}copy(t){this.set(t.x,t.y,t.width,t.height)}overlaps(t){return this.x1>=t.x&&this.x<t.x1&&this.y1>=t.y&&this.y<t.y1}contains(i){return i instanceof e?i.x1<=this.x1&&i.x>=this.x&&i.y1<=this.y1&&i.y>=this.y:i instanceof t&&!(i.x<this.x||i.y<this.y||i.x>=this.x1||i.y>=this.y1)}}const i=(t,e,i)=>Math.min(i,Math.max(e,t)),s=(t,e)=>Math.round(Math.random()*(e-t))+t,n=(t,e,i)=>t>=e&&t<=i;class r{constructor(e=null,i=null){this._degrees=0,this._radians=0,this._direction=new t,e?this.radians=e:i&&(this.degrees=i)}set degrees(t){this._degrees=t,this._radians=t*Math.PI/180,this.updateDirection()}get degrees(){return this._degrees}set radians(t){this._radians=t,this._degrees=180*t/Math.PI,this.updateDirection()}get radians(){return this._radians}get direction(){return this._direction}updateDirection(){this._direction.set(Math.cos(this._radians),Math.sin(this._radians))}}var o=function(t,e){return o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},o(t,e)};function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function i(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}var h=function(){return h=Object.assign||function(t){for(var e,i=1,s=arguments.length;i<s;i++)for(var n in e=arguments[i])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t},h.apply(this,arguments)};function l(t,e,i){if(i||2===arguments.length)for(var s,n=0,r=e.length;n<r;n++)!s&&n in e||(s||(s=Array.prototype.slice.call(e,0,n)),s[n]=e[n]);return t.concat(s||Array.prototype.slice.call(e))}var c,d=function(){var t=(new Date).getTime(),e="undefined"!=typeof performance&&performance.now&&1e3*performance.now()||0;return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(i){var s=16*Math.random();return t>0?(s=(t+s)%16|0,t=Math.floor(t/16)):(s=(e+s)%16|0,e=Math.floor(e/16)),("x"==i?s:7&s|8).toString(16)}))};!function(t){t[t.Init=0]="Init",t[t.Start=1]="Start",t[t.Update=2]="Update",t[t.UpdateEngine=3]="UpdateEngine",t[t.UpdateCollider=4]="UpdateCollider",t[t.UpdatePhysics=5]="UpdatePhysics",t[t.UpdateTransform=6]="UpdateTransform",t[t.UpdatePreRender=7]="UpdatePreRender",t[t.UpdateCamera=8]="UpdateCamera",t[t.UpdateRender=9]="UpdateRender",t[t.Destroy=10]="Destroy"}(c||(c={}));var u,p=function(){function t(t,e,i,s,n,r,o){this.timeManager=t,this.physicsManager=e,this.renderManager=i,this.inputManager=s,this.gameObjectManager=n,this.sceneManager=r,this.canvasColor=o,this.running=!1,this.gameLoopAccumulator=0,this.gameObjects=[],this.components=[]}return t.prototype.start=function(){this.startLoop(!0)},t.prototype.pause=function(){this.running=!1},t.prototype.resume=function(){this.startLoop(!1)},t.prototype.stop=function(){this.running=!1,this.sceneManager.unloadCurrentScene(),this.physicsManager.clear(),this.renderManager.clearScreen(this.canvasColor)},t.prototype.startLoop=function(t){this.running||(this.running=!0,t&&this.sceneManager.loadOpeningScene(),this.requestAnimationLoop(window.performance.now()),this.timeManager.gameFramerate!==this.timeManager.physicsFramerate&&this.asyncPhysicsLoop())},t.prototype.requestAnimationLoop=function(t){var e=this;this.running&&(this.timeManager.updateForBrowser(.001*t),this.gameLoopAccumulator+=this.timeManager.browserDeltaTime,this.gameLoopAccumulator>=this.timeManager.minGameDeltatime&&(this.gameLogicIteration(.001*t),this.gameLoopAccumulator-=this.timeManager.minGameDeltatime),this.renderIteration(),window.requestAnimationFrame((function(t){return e.requestAnimationLoop(t)})))},t.prototype.gameLogicIteration=function(t){this.timeManager.updateForGame(t),this.load(),this.dispatchFrameEvent(c.Start),this.inputManager.update(),this.dispatchFrameEvent(c.Update),this.dispatchFrameEvent(c.UpdateEngine),this.dispatchFrameEvent(c.UpdateTransform),this.timeManager.gameFramerate===this.timeManager.physicsFramerate&&(this.timeManager.updateForPhysics(t),this.physicsIteration()),this.dispatchFrameEvent(c.UpdatePreRender),this.sceneManager.update()},t.prototype.renderIteration=function(){this.dispatchFrameEvent(c.UpdatePreRender),this.dispatchFrameEvent(c.UpdateCamera),this.dispatchFrameEvent(c.UpdateRender),this.renderManager.clearScreen(this.canvasColor),this.renderManager.render(),this.renderManager.clearData()},t.prototype.physicsIteration=function(){this.timeManager.timeScale<=0||(this.dispatchFrameEvent(c.UpdatePhysics),this.dispatchFrameEvent(c.UpdateCollider),this.dispatchFrameEvent(c.UpdateTransform),this.physicsManager.resolve(this.timeManager.physicsDeltaTime))},t.prototype.asyncPhysicsLoop=function(){var t=this;this.physicsIntervalId=window.setInterval((function(){if(!t.running)return window.clearInterval(t.physicsIntervalId);t.timeManager.updateForPhysics(.001*window.performance.now()),document.hidden||t.physicsIteration()}),1e3/this.timeManager.physicsFramerate)},t.prototype.load=function(){this.currentScene=this.sceneManager.getCurrentScene(),this.gameObjects=this.gameObjectManager.findGameObjects().filter((function(t){return t.active})),this.components=this.gameObjects.reduce((function(t,e){return l(l([],t,!0),e.getComponents().filter((function(t){return t.active})),!0)}),[])},t.prototype.dispatchFrameEvent=function(t){t!==c.Start&&t!==c.Update||(this.currentScene.dispatch(t),this.gameObjects.filter((function(t){return t.active})).forEach((function(e){return e.dispatch(t)}))),this.components.filter((function(t){return t.active})).forEach((function(e){return e.dispatch(t)}))},t}(),g=function(){function t(t){this.updateEvent=c.Update,this.started=!1,this.container=t,this.gameObjectManager=this.container.getSingleton("GameObjectManager")}return t.prototype.dispatch=function(t,e){t===c.Init&&this.init?this.init(e):t!==c.Start||this.started?t===this.updateEvent&&this.started&&this.update?this.update():t===c.Destroy&&(this.onDestroy&&this.onDestroy(),this._destroy()):(this.start&&this.start(),this.started=!0)},t.prototype.addGameObject=function(t,e,i){return"string"==typeof e&&(i=e,e={}),this.gameObjectManager.addGameObject(t,e,void 0,i)},t.prototype.findGameObjects=function(t){return t?this.gameObjectManager.findGameObjects(t):this.gameObjectManager.findGameObjects()},t.prototype.findGameObject=function(t){return this.gameObjectManager.findGameObject(t)},t.prototype.findGameObjectsByTag=function(t){return this.gameObjectManager.findGameObjectsByTag(t)},t.prototype.destroyGameObject=function(t){this.gameObjectManager.destroyGameObject(t)},t}(),m=function(t){function e(e,i,s){void 0===s&&(s="");var n=t.call(this,e)||this;return n.id=d(),n.allowMultiple=!0,n._active=!0,n.gameObject=i,n.name=s,n}return a(e,t),Object.defineProperty(e.prototype,"active",{get:function(){return this._active},set:function(t){this._active=t,this.onActiveChange()},enumerable:!1,configurable:!0}),e.prototype.onActiveChange=function(){},e.prototype.getCurrentScene=function(){return this.container.getSingleton("SceneManager").getCurrentScene()},e.prototype.getGameObject=function(){return this.gameObject},e.prototype.getComponents=function(t){return t?this.gameObject.getComponents(t):this.gameObject.getComponents()},e.prototype.getComponent=function(t){return this.gameObject.getComponent(t)},e.prototype.hasComponent=function(t){return this.gameObject.hasComponent(t)},e.prototype.removeComponent=function(t){this.gameObject.removeComponent(t)},e.prototype._destroy=function(){var t=this;Object.keys(this).forEach((function(e){return delete t[e]}))},e}(g),f=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.updateEvent=c.UpdateEngine,e}return a(e,t),e}(m),y=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.updateEvent=c.UpdateCollider,e}return a(e,t),e}(m),x=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.updateEvent=c.UpdatePhysics,e}return a(e,t),e}(m),v=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.updateEvent=c.UpdateTransform,e}return a(e,t),e}(m),b=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.updateEvent=c.UpdatePreRender,e}return a(e,t),e}(m),M=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.updateEvent=c.UpdateCamera,e}return a(e,t),e}(m),w=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.updateEvent=c.UpdateRender,e}return a(e,t),e}(m);!function(t){t.Image="Image",t.Audio="Audio",t.Font="Font"}(u||(u={}));var C,j,P,_,O,R=function(){function t(){this.assets=[]}return t.prototype.getAssetsLoaded=function(){return this.assets.reduce((function(t,e){return t&&e.loaded}),!0)},t.prototype.loadImage=function(t){var e=new Image;e.crossOrigin="",e.src=t;var i=this.createAsset(t,u.Image,e);return e.naturalWidth?i.loaded=!0:e.addEventListener("load",(function(){return i.loaded=!0})),e},t.prototype.loadAudio=function(t){var e=new Audio;e.src=t;var i=this.createAsset(t,u.Audio,e);return e.duration?i.loaded=!0:e.addEventListener("canplaythrough",(function(){return i.loaded=!0})),e},t.prototype.loadFont=function(t,e){var i=new FontFace(t,"url(".concat(e,")")),s=this.createAsset(e,u.Font,i);return s.family=t,i.load().then((function(t){document.fonts.add(t),s.loaded=!0})),i},t.prototype.getImage=function(t){var e;return null===(e=this.assets.find((function(e){return e.type===u.Image&&e.url===t})))||void 0===e?void 0:e.element},t.prototype.getAudio=function(t){var e;return null===(e=this.assets.find((function(e){return e.type===u.Audio&&e.url===t})))||void 0===e?void 0:e.element},t.prototype.getFont=function(t){var e;return null===(e=this.assets.find((function(e){return e.type===u.Font&&e.family===t})))||void 0===e?void 0:e.element},t.prototype.createAsset=function(t,e,i){var s={type:e,url:t,element:i,loaded:!1};return this.assets.push(s),s},t}(),S=function(t){function e(e){var i=t.call(this,e)||this;return i.name="AngryPixelException",i}return a(e,t),e}(Error),A=function(){function t(t,e,i){if(this._canvas=null,!t)throw new S("containerNode cannot be empty or null.");this.containerNode=t,this.gameWidth=e,this.gameHeight=i,this.setupCanvas()}return Object.defineProperty(t.prototype,"canvas",{get:function(){return this._canvas},enumerable:!1,configurable:!0}),t.prototype.setupCanvas=function(){this._canvas=document.createElement("canvas"),this._canvas.id="angryPixelGameCanvas",this._canvas.width=Math.floor(this.gameWidth),this._canvas.height=Math.floor(this.gameHeight),this.canvas.tabIndex=0,this._canvas.addEventListener("contextmenu",(function(t){return t.preventDefault()})),this.containerNode.appendChild(this._canvas),this.canvas.focus()},t}(),T=function(){function t(t){this.container=t,this.gameObjects=[]}return t.prototype.addGameObject=function(t,e,i,s){var n=new t(this.container,s,i);return this.gameObjects.push(n),n.dispatch(c.Init,e),n},t.prototype.findGameObjects=function(t){return t?this.gameObjects.filter((function(e){return e instanceof t})):l([],this.gameObjects,!0)},t.prototype.findGameObjectById=function(t){return this.gameObjects.find((function(e){return e.id===t}))},t.prototype.findGameObject=function(t){return"string"==typeof t?this.gameObjects.find((function(e){return e.name===t})):this.gameObjects.find((function(e){return e instanceof t}))},t.prototype.findGameObjectsByParent=function(t){return this.gameObjects.filter((function(e){return e.parent===t}))},t.prototype.findGameObjectByParent=function(t,e){return"string"==typeof e?this.gameObjects.find((function(i){return i.name===e&&i.parent===t})):this.gameObjects.find((function(i){return i instanceof e&&i.parent===t}))},t.prototype.findGameObjectsByTag=function(t){return this.gameObjects.filter((function(e){return e.tag===t}))},t.prototype.destroyAllGameObjects=function(){var t=this;this.gameObjects.filter((function(t){return!t.keep})).forEach((function(e){return t.destroy(e,!1)}))},t.prototype.destroyGameObject=function(t){this.destroy(t,!0)},t.prototype.destroy=function(t,e){var i=this.gameObjects.indexOf(t);if(-1!==i){var s=this.gameObjects.splice(i,1)[0];e&&this.destroyChildren(s),s.dispatch(c.Destroy)}},t.prototype.destroyChildren=function(t){var e=this;this.findGameObjectsByParent(t).forEach((function(t){return e.destroyGameObject(t)}))},t}(),D=function(){function t(){var t=this;this.gamepads=new Map,this.eventHandler=function(e){"gamepadconnected"===e.type?t.gamepadConnected(e.gamepad):"gamepaddisconnected"===e.type&&t.gamepadDisconected(e.gamepad)},window.addEventListener("gamepadconnected",this.eventHandler),window.addEventListener("gamepaddisconnected",this.eventHandler)}return t.prototype.getGamepad=function(t){var e;return null!==(e=this.gamepads.get(t))&&void 0!==e?e:null},t.prototype.gamepadConnected=function(t){this.gamepads.set(t.index,new F),this.gamepads.get(t.index).updateFromGamepad(t)},t.prototype.gamepadDisconected=function(t){this.gamepads.delete(t.index)},t.prototype.update=function(){for(var t=0,e=this.getGamepads();t<e.length;t++){var i=e[t];null!==i&&(!1===this.gamepads.has(i.index)&&this.gamepadConnected(i),this.gamepads.get(i.index).updateFromGamepad(i))}},t.prototype.getGamepads=function(){return navigator.getGamepads?navigator.getGamepads():navigator.webkitGetGamepads?navigator.webkitGetGamepads:[]},t}(),F=function(){function e(){this.buttons=new Map,this.axes=new Map,this._dpadAxes=new t,this._leftStickAxes=new t,this._rightStickAxes=new t}return e.prototype.updateFromGamepad=function(t){var e=this;this._gamepad=t,t.buttons.forEach((function(t,i){return e.buttons.set(i,t.pressed)})),t.axes.forEach((function(t,i){return e.axes.set(i,t)}))},Object.defineProperty(e.prototype,"id",{get:function(){return this._gamepad.id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"connected",{get:function(){return this._gamepad.connected},enumerable:!1,configurable:!0}),e.prototype.getButtonPressed=function(t){return this.buttons.get(t)},e.prototype.getAxis=function(t){return this.axes.get(t)},Object.defineProperty(e.prototype,"dpadAxes",{get:function(){return this._dpadAxes.set(this.dpadRight?1:this.dpadLeft?-1:0,this.dpadUp?1:this.dpadDown?-1:0),this._dpadAxes},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"leftStickAxes",{get:function(){return this._leftStickAxes.set(this.leftStickHorizontal,this.leftStickVertical),this._leftStickAxes},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rightStickAxes",{get:function(){return this._rightStickAxes.set(this.rightStickHorizontal,this.rightStickVertical),this._rightStickAxes},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dpadUp",{get:function(){var t;return null!==(t=this.buttons.get(12))&&void 0!==t&&t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dpadDown",{get:function(){var t;return null!==(t=this.buttons.get(13))&&void 0!==t&&t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dpadLeft",{get:function(){var t;return null!==(t=this.buttons.get(14))&&void 0!==t&&t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"dpadRight",{get:function(){var t;return null!==(t=this.buttons.get(15))&&void 0!==t&&t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bottomFace",{get:function(){var t;return null!==(t=this.buttons.get(0))&&void 0!==t&&t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rightFace",{get:function(){var t;return null!==(t=this.buttons.get(1))&&void 0!==t&&t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"leftFace",{get:function(){var t;return null!==(t=this.buttons.get(2))&&void 0!==t&&t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"topFace",{get:function(){var t;return null!==(t=this.buttons.get(3))&&void 0!==t&&t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"leftShoulder",{get:function(){var t;return null!==(t=this.buttons.get(4))&&void 0!==t&&t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rightShoulder",{get:function(){var t;return null!==(t=this.buttons.get(5))&&void 0!==t&&t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"leftTrigger",{get:function(){var t;return null!==(t=this.buttons.get(6))&&void 0!==t&&t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rightTrigger",{get:function(){var t;return null!==(t=this.buttons.get(7))&&void 0!==t&&t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"back",{get:function(){var t;return null!==(t=this.buttons.get(8))&&void 0!==t&&t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"start",{get:function(){var t;return null!==(t=this.buttons.get(9))&&void 0!==t&&t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"leftStickButton",{get:function(){var t;return null!==(t=this.buttons.get(10))&&void 0!==t&&t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rightStickButton",{get:function(){var t;return null!==(t=this.buttons.get(11))&&void 0!==t&&t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"leftStickHorizontal",{get:function(){var t;return null!==(t=this.axes.get(0))&&void 0!==t?t:0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"leftStickVertical",{get:function(){var t;return null!==(t=-this.axes.get(1))&&void 0!==t?t:0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rightStickHorizontal",{get:function(){var t;return null!==(t=this.axes.get(2))&&void 0!==t?t:0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rightStickVertical",{get:function(){var t;return null!==(t=-this.axes.get(3))&&void 0!==t?t:0},enumerable:!1,configurable:!0}),e.prototype.vibrate=function(t,e,i,s){void 0===t&&(t=200),void 0===e&&(e=.2),void 0===i&&(i=.2),void 0===s&&(s=0),this._gamepad.vibrationActuator&&this._gamepad.vibrationActuator.playEffect(this._gamepad.vibrationActuator.type,{duration:t,weakMagnitude:e,strongMagnitude:i,startDelay:s})},e}(),E=function(){function t(t,e,i,s){this.mouse=t,this.keyboard=e,this.gamepad=i,this.touch=s}return t.prototype.update=function(){this.mouse.update(),this.gamepad.update()},t}(),B=function(){function t(t){var e=this;this.keyPresses=new Map,this.eventHandler=function(t){"keydown"===t.type&&e.keyPresses.set(t.code,!0),"keyup"===t.type&&e.keyPresses.set(t.code,!1)},this.canvas=t,this.canvas.addEventListener("keydown",this.eventHandler),this.canvas.addEventListener("keyup",this.eventHandler)}return t.prototype.isPressed=function(t){var e;return null!==(e=this.keyPresses.get(t))&&void 0!==e&&e},t.prototype.orPressed=function(t){var e=this;return t.reduce((function(t,i){var s;return t||null!==(s=e.keyPresses.get(i))&&void 0!==s&&s}),!1)},t.prototype.andPressed=function(t){var e=this;return t.reduce((function(t,i){var s;return t&&null!==(s=e.keyPresses.get(i))&&void 0!==s&&s}),!0)},t.prototype.isPressedReturn=function(t,e,i){return this.keyPresses.get(t)?e:i},t.prototype.orPressedReturn=function(t,e,i){var s=this;return t.reduce((function(t,e){var i;return t||null!==(i=s.keyPresses.get(e))&&void 0!==i&&i}),!1)?e:i},t.prototype.andPressedReturn=function(t,e,i){var s=this;return t.reduce((function(t,e){var i;return t&&null!==(i=s.keyPresses.get(e))&&void 0!==i&&i}),!0)?e:i},t}(),I=function(){function e(e){this._leftButtonPressed=!1,this._scrollButtonPressed=!1,this._rightButtonPressed=!1,this._positionInViewport=new t(0,0),this._hasMoved=!1,this.lastPositionInViewport=new t(0,0),this.canvas=e,this.setup()}return Object.defineProperty(e.prototype,"leftButtonPressed",{get:function(){return this._leftButtonPressed},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"scrollButtonPressed",{get:function(){return this._scrollButtonPressed},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rightButtonPressed",{get:function(){return this._rightButtonPressed},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"positionInViewport",{get:function(){return this._positionInViewport},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasMoved",{get:function(){return this._hasMoved},enumerable:!1,configurable:!0}),e.prototype.update=function(){!1===this._positionInViewport.equals(this.lastPositionInViewport)?(this._hasMoved=!0,this.lastPositionInViewport.copy(this._positionInViewport)):this._hasMoved=!1},e.prototype.setup=function(){var t=this;this.canvas.addEventListener("mousemove",(function(e){return t.updatePosition(e)})),this.canvas.addEventListener("mousedown",(function(e){return t.updateButtonDown(e)})),this.canvas.addEventListener("mouseup",(function(e){return t.updateButtonUp(e)}))},e.prototype.updateButtonDown=function(t){this.canvas.focus(),t.preventDefault(),t.stopPropagation(),this._leftButtonPressed=0===t.button,this._scrollButtonPressed=1===t.button,this._rightButtonPressed=2===t.button},e.prototype.updateButtonUp=function(t){t.preventDefault(),t.stopPropagation(),this._leftButtonPressed=0!==t.button&&this._leftButtonPressed,this._scrollButtonPressed=1!==t.button&&this._scrollButtonPressed,this._rightButtonPressed=2!==t.button&&this._rightButtonPressed},e.prototype.updatePosition=function(t){t.preventDefault(),t.stopPropagation(),this._positionInViewport.set(t.offsetX/(this.canvas.clientWidth/this.canvas.width)-this.canvas.width/2,-t.offsetY/(this.canvas.clientHeight/this.canvas.height)+this.canvas.height/2)},e}(),U=function(){function t(t,e){this.container=t,this.renderManager=e,this.scenes=new Map,this.currentScene=null,this.openingSceneName=null,this.sceneToLoad=null}return t.prototype.getCurrentScene=function(){return this.currentScene},t.prototype.addScene=function(t,e,i,s){var n=this;if(void 0===s&&(s=!1),this.scenes.has(e))throw new S("There is already a scene with the name '".concat(e,"'"));this.scenes.set(e,(function(){var s=new t(n.container,e,n.container.getConstant("Game"));return n.currentScene=s,s.dispatch(c.Init,i),s})),!0!==s&&null!==this.openingSceneName||(this.openingSceneName=e)},t.prototype.loadOpeningScene=function(){if(null===this.openingSceneName)throw new S("There is no opening scene");this._loadScene(this.openingSceneName)},t.prototype.loadScene=function(t){if(!1===this.scenes.has(t))throw new S("Scene with name ".concat(t," does not exists"));this.sceneToLoad=t},t.prototype.update=function(){null!==this.sceneToLoad&&(this._loadScene(this.sceneToLoad),this.sceneToLoad=null)},t.prototype._loadScene=function(t){this.unloadCurrentScene(),this.scenes.get(t)()},t.prototype.unloadCurrentScene=function(){null!==this.currentScene&&(this.currentScene.dispatch(c.Destroy),this.currentScene=null,this.currentSceneName=null,this.renderManager&&this.renderManager.clearData())},t}(),G=[60,120,180,240],L=function(){function t(t){if(this.minGameDeltatime=0,this.minPhysicsDeltaTime=0,this.gameFramerate=60,this.physicsFramerate=180,this.timeScale=1,this.browserDeltaTime=0,this.gameDeltaTime=0,this.unscaledGameDeltaTime=0,this.unscaledPhysicsDeltaTime=0,this.maxDeltaTime=1/30,this.thenForGame=0,this.thenForPhysics=0,this.thenForBrowser=0,!G.includes(t))throw new S("Invalid Physics frame rate. Allowed: [".concat(G.join(", "),"]"));this.physicsFramerate=t,this.minGameDeltatime=parseFloat((1/this.gameFramerate).toFixed(6)),this.minPhysicsDeltaTime=parseFloat((1/this.physicsFramerate).toFixed(6))}return t.prototype.updateForGame=function(t){this.unscaledGameDeltaTime=Math.min(Math.max(this.minGameDeltatime,t-this.thenForGame),this.maxDeltaTime),this.thenForGame=t},t.prototype.updateForBrowser=function(t){this.browserDeltaTime=Math.min(Math.max(0,t-this.thenForBrowser),this.maxDeltaTime),this.thenForBrowser=t},t.prototype.updateForPhysics=function(t){this.unscaledPhysicsDeltaTime=Math.min(Math.max(0,t-this.thenForPhysics),this.maxDeltaTime),this.thenForPhysics=t},Object.defineProperty(t.prototype,"deltaTime",{get:function(){return this.unscaledGameDeltaTime*this.timeScale},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"physicsDeltaTime",{get:function(){return this.unscaledPhysicsDeltaTime*this.timeScale},enumerable:!1,configurable:!0}),t}(),k=function(){function e(e){var i=this;this._touching=!1,this._positionInViewport=new t(0,0),this._radius=new t(0,0),this.eventHandler=function(t){"touchstart"===t.type&&(i._touching=!0,i.updatePosition(t)),"touchmove"===t.type&&i.updatePosition(t),"touchend"!==t.type&&"touchcancel"!==t.type||(i._touching=!1)},this.canvas=e,this.canvas.addEventListener("touchstart",this.eventHandler),this.canvas.addEventListener("touchend",this.eventHandler),this.canvas.addEventListener("touchcancel",this.eventHandler),this.canvas.addEventListener("touchmove",this.eventHandler)}return Object.defineProperty(e.prototype,"positionInViewport",{get:function(){return this._positionInViewport},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"touching",{get:function(){return this._touching},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"radius",{get:function(){return this._radius},enumerable:!1,configurable:!0}),e.prototype.updatePosition=function(t){t.preventDefault(),t.stopPropagation(),0!==t.targetTouches.length&&(this._positionInViewport.set((t.targetTouches[0].clientX-this.canvas.offsetLeft)/(this.canvas.clientWidth/this.canvas.width)-this.canvas.width/2,-(t.targetTouches[0].clientY-this.canvas.offsetTop)/(this.canvas.clientHeight/this.canvas.height)+this.canvas.height/2),this._radius.set(t.targetTouches[0].radiusX,t.targetTouches[0].radiusY))},e}(),W=function(){function t(){}return t.initialize=function(t){this.assetManager=t},t.getAssetsLoaded=function(){return this.assetManager.getAssetsLoaded()},t.loadImage=function(t){return this.assetManager.loadImage(t)},t.loadAudio=function(t){return this.assetManager.loadAudio(t)},t.loadFont=function(t,e){return this.assetManager.loadFont(t,e)},t.getImage=function(t){return this.assetManager.getImage(t)},t.getAudio=function(t){return this.assetManager.getAudio(t)},t.getFont=function(t){return this.assetManager.getFont(t)},t.assetManager=null,t}(),V=function(){function t(){}return t.initialize=function(t){this.domManager=t},Object.defineProperty(t,"gameWidth",{get:function(){return this.domManager.canvas.width},enumerable:!1,configurable:!0}),Object.defineProperty(t,"gameHeight",{get:function(){return this.domManager.canvas.height},enumerable:!1,configurable:!0}),Object.defineProperty(t,"canvas",{get:function(){return this.domManager.canvas},enumerable:!1,configurable:!0}),t.domManager=null,t}(),H=function(){function t(){}return t.initialize=function(t){this.inputManager=t},Object.defineProperty(t,"mouse",{get:function(){return this.inputManager.mouse},enumerable:!1,configurable:!0}),Object.defineProperty(t,"keyboard",{get:function(){return this.inputManager.keyboard},enumerable:!1,configurable:!0}),Object.defineProperty(t,"gamepad",{get:function(){return this.inputManager.gamepad},enumerable:!1,configurable:!0}),Object.defineProperty(t,"touch",{get:function(){return this.inputManager.touch},enumerable:!1,configurable:!0}),t.inputManager=null,t}(),z=function(){function t(){}return t.initialize=function(t){this.sceneManager=t},t.loadScene=function(t){this.sceneManager.loadScene(t)},t.getCurrentSceneName=function(){return this.sceneManager.currentSceneName},t.loadOpeningScene=function(){this.sceneManager.loadOpeningScene()},t.sceneManager=null,t}(),Y=function(){function t(){}return t.initialize=function(t){this.timeManager=t},Object.defineProperty(t,"deltaTime",{get:function(){return this.timeManager.deltaTime},enumerable:!1,configurable:!0}),t.getTimeScale=function(){return this.timeManager.timeScale},t.setTimeScale=function(t){this.timeManager.timeScale=t},Object.defineProperty(t,"unscaledDeltaTime",{get:function(){return this.timeManager.unscaledGameDeltaTime},enumerable:!1,configurable:!0}),Object.defineProperty(t,"physicsDeltaTime",{get:function(){return this.timeManager.physicsDeltaTime},enumerable:!1,configurable:!0}),Object.defineProperty(t,"browserDeltaTime",{get:function(){return this.timeManager.browserDeltaTime},enumerable:!1,configurable:!0}),t.timeManager=null,t}(),X=function(){function t(){}return t.initialize=function(t){this.manager=t},t.addGameObject=function(t,e,i,s){return this.manager.addGameObject(t,e,i,s)},t.findAllGameObjects=function(){return this.manager.findGameObjects()},t.findGameObjects=function(t){return this.manager.findGameObjects(t)},t.findGameObject=function(t){return this.manager.findGameObject(t)},t.findGameObjectsByParent=function(t){return this.manager.findGameObjectsByParent(t)},t.findGameObjectByParent=function(t,e){return this.manager.findGameObjectByParent(t,e)},t.findGameObjectsByTag=function(t){return this.manager.findGameObjectsByTag(t)},t.destroyGameObject=function(t){this.manager.destroyGameObject(t)},t}(),N=function(){function t(t,e,i,s){this.timeManager=t,this.physicsManager=e,this.gameObjectManager=i,this.sceneManager=s,this.running=!1,this.gameObjects=[],this.components=[]}return t.prototype.start=function(){this.startLoop(!0)},t.prototype.pause=function(){this.running=!1},t.prototype.resume=function(){this.startLoop(!1)},t.prototype.stop=function(){this.running=!1,this.sceneManager.unloadCurrentScene(),this.physicsManager.clear()},t.prototype.startLoop=function(t){this.running||(this.running=!0,t&&this.sceneManager.loadOpeningScene(),this.asyncGameLoop(),this.timeManager.gameFramerate!==this.timeManager.physicsFramerate&&this.asyncPhysicsLoop())},t.prototype.gameLogicIteration=function(t){this.timeManager.updateForGame(t),this.load(),this.dispatchFrameEvent(c.Start),this.dispatchFrameEvent(c.Update),this.dispatchFrameEvent(c.UpdateEngine),this.dispatchFrameEvent(c.UpdateTransform),this.timeManager.gameFramerate===this.timeManager.physicsFramerate&&(this.timeManager.updateForPhysics(t),this.physicsIteration()),this.sceneManager.update()},t.prototype.physicsIteration=function(){this.timeManager.timeScale<=0||(this.dispatchFrameEvent(c.UpdatePhysics),this.dispatchFrameEvent(c.UpdateCollider),this.dispatchFrameEvent(c.UpdateTransform),this.physicsManager.resolve(this.timeManager.physicsDeltaTime))},t.prototype.asyncGameLoop=function(){var t=this;this.gameInterval=setInterval((function(){if(!t.running)return clearInterval(t.gameInterval);t.gameLogicIteration(process.uptime())}),1e3/this.timeManager.gameFramerate)},t.prototype.asyncPhysicsLoop=function(){var t=this;this.physicsInterval=setInterval((function(){if(!t.running)return clearInterval(t.physicsInterval);t.timeManager.updateForPhysics(process.uptime()),t.physicsIteration()}),1e3/this.timeManager.physicsFramerate)},t.prototype.load=function(){this.currentScene=this.sceneManager.getCurrentScene(),this.gameObjects=this.gameObjectManager.findGameObjects().filter((function(t){return t.active})),this.components=this.gameObjects.reduce((function(t,e){return l(l([],t,!0),e.getComponents().filter((function(t){return t.active})),!0)}),[])},t.prototype.dispatchFrameEvent=function(t){t!==c.Start&&t!==c.Update||(this.currentScene.dispatch(t),this.gameObjects.filter((function(t){return t.active})).forEach((function(e){return e.dispatch(t)}))),this.components.filter((function(t){return t.active})).forEach((function(e){return e.dispatch(t)}))},t}();!function(t){t[t.Polygon=0]="Polygon",t[t.Circumference=1]="Circumference",t[t.Line=2]="Line"}(C||(C={})),function(t){t[t.WorldSpace=0]="WorldSpace",t[t.ViewPort=1]="ViewPort"}(j||(j={})),function(t){t[t.Sprite=0]="Sprite",t[t.Text=1]="Text",t[t.Tilemap=2]="Tilemap",t[t.Mask=3]="Mask",t[t.Geometric=4]="Geometric"}(P||(P={}));class q{constructor(t){this.gl=t,this.viewport={x:0,x1:0,y:0,y1:0},this.object={x:0,x1:0,y:0,y1:0}}setViewport({position:t,zoom:e},i){i===j.WorldSpace?(this.viewport.x=t.x-this.gl.canvas.width/e/2,this.viewport.x1=t.x+this.gl.canvas.width/e/2,this.viewport.y=t.y-this.gl.canvas.height/e/2,this.viewport.y1=t.y+this.gl.canvas.height/e/2):(this.viewport.x=-this.gl.canvas.width/2,this.viewport.x1=this.gl.canvas.width/2,this.viewport.y=-this.gl.canvas.height/2,this.viewport.y1=this.gl.canvas.height/2)}setObjectForResizeable({position:t,width:e,height:i,rotation:s=0}){const n=Math.abs(Math.sin(s)),r=Math.abs(Math.cos(s)),o=n*i+r*e,a=n*e+r*i;this.object.x=t.x-o/2,this.object.x1=t.x+o/2,this.object.y=t.y-a/2,this.object.y1=t.y+a/2}setObjectForText({position:t,text:e,fontSize:i,lineSeparation:s,letterSpacing:n,rotation:r}){const o=e.split("\n").reduce(((t,e)=>Math.max(t,e.length)),0)*(i+(null!=n?n:0))*2,a=e.split("\n").length*(i+(null!=s?s:0));this.setObjectForResizeable({position:t,width:o,height:a,rotation:r})}setObjectForGeometric({position:t,vertexModel:e,shape:i,radius:s}){i===C.Circumference?(this.object.x=t.x-s,this.object.y=t.y-s,this.object.x1=t.x+s,this.object.y1=t.y+s):(this.object.x=Number.MAX_SAFE_INTEGER,this.object.y=Number.MAX_SAFE_INTEGER,this.object.x1=Number.MIN_SAFE_INTEGER,this.object.y1=Number.MIN_SAFE_INTEGER,e.forEach((e=>{this.object.x=Math.min(e.x+t.x,this.object.x),this.object.y=Math.min(e.y+t.y,this.object.y),this.object.x1=Math.max(e.x+t.x,this.object.x1),this.object.y1=Math.max(e.y+t.y,this.object.y1)})))}setObjectForTilemap(t){t.tilemap.height=Math.ceil(t.tiles.length/t.tilemap.width),this.setObjectForResizeable({position:t.renderPosition,width:t.tilemap.width*t.tilemap.tileWidth,height:t.tilemap.height*t.tilemap.tileHeight,rotation:t.rotation})}applyCullingInTiles(t){const{tiles:e,tilemap:{width:i,tileWidth:s,tileHeight:n}}=t;t.culledTiles=e.map(((t,e)=>this.viewport.x1>=this.object.x+e%i*s&&this.viewport.x<=this.object.x+e%i*s+s&&this.viewport.y1>=this.object.y1-((e/i|0)*n+n)&&this.viewport.y<=this.object.y1-(e/i|0)*n?t:0))}isInViewPort(t,e){switch(this.setViewport(e,t.location),t.type){case P.Mask:case P.Sprite:this.setObjectForResizeable(t);break;case P.Geometric:this.setObjectForGeometric(t);break;case P.Text:this.setObjectForText(t);break;case P.Tilemap:this.setObjectForTilemap(t)}return this.viewport.x1>=this.object.x&&this.viewport.x<=this.object.x1&&this.viewport.y1>=this.object.y&&this.viewport.y<=this.object.y1}applyCulling(t,e){return e.filter((e=>!!this.isInViewPort(e,t)&&(e.type===P.Tilemap&&this.applyCullingInTiles(e),!0)))}}class K{constructor(t=0,e=0){this._x=t,this._y=e}get x(){return this._x}set x(t){this._x=t}get y(){return this._y}set y(t){this._y=t}get magnitude(){return Math.sqrt(Math.pow(this._x,2)+Math.pow(this._y,2))}set(t,e){this._x=t,this._y=e}copy(t){this.set(t.x,t.y)}equals(t){return this._x===t.x&&this._y===t.y}clone(){return new K(this._x,this._y)}distance(t){return Math.sqrt(Math.pow(this._x-t.x,2)+Math.pow(this._y-t.y,2))}static add(t,e,i){return t.set(e.x+i.x,e.y+i.y),t}static subtract(t,e,i){return t.set(e.x-i.x,e.y-i.y),t}static unit(t,e){return 0===e.magnitude?t.set(0,0):t.set(e.x/e.magnitude,e.y/e.magnitude),t}static normal(t,e){return t.set(-e.y,e.x),this.unit(t,t)}static scale(t,e,i){return t.set(e.x*i,e.y*i),t}static dot(t,e){return t.x*e.x+t.y*e.y}static cross(t,e){return t.x*e.y-t.y*e.x}static round(t,e){return t.set(Math.round(e.x),Math.round(e.y)),t}}!function(t){t[t.Center=0]="Center",t[t.RightUp=1]="RightUp",t[t.RightDown=2]="RightDown",t[t.RightCenter=3]="RightCenter"}(_||(_={}));class ${constructor(t,e){this.webglManager=t,this.cullingManager=e,this.renderData=[],this.cameraData=[]}addRenderData(t){this.renderData.push(t)}addCameraData(t){this.cameraData.push(t)}render(){this.cameraData.sort(((t,e)=>t.depth-e.depth)).forEach((t=>this.renderByCamera(t)))}renderByCamera(t){this.cullingManager.applyCulling(t,this.renderData.filter((e=>t.layers.includes(e.layer))).sort(((e,i)=>t.layers.indexOf(e.layer)-t.layers.indexOf(i.layer))).map((t=>t.type===P.Tilemap?(t=>{const e=Object.assign(Object.assign({},t),{culledTiles:[],tilemap:Object.assign(Object.assign({},t.tilemap),{height:Math.ceil(t.tiles.length/t.tilemap.width),realWidth:t.tilemap.width*t.tilemap.tileWidth,realHeight:0}),renderPosition:new K});return e.tilemap.realHeight=e.tilemap.height*e.tilemap.tileHeight,(t=>{t.renderPosition.set(t.position.x+(t.orientation!==_.Center?t.tilemap.realWidth/2:0),t.position.y+(t.orientation===_.RightDown?-t.tilemap.realHeight/2:t.orientation===_.RightUp?t.tilemap.realHeight/2:0))})(e),e})(t):t))).forEach((e=>this.webglManager.render(e,t)))}clearData(){this.renderData=[],this.cameraData=[]}clearScreen(t){this.webglManager.clearCanvas(t)}}!function(t){t.LegacyWebGL="webgl",t.WebGL2="webgl2"}(O||(O={}));class Q{constructor(t){if(this.canvas=t,this.contextVersion=this.getContextVersion(),!this.contextVersion)throw new Error("Your browser does not support WebGL.");this.gl=this.canvas.getContext(this.contextVersion)}getContextVersion(){return null!==this.canvas.getContext(O.WebGL2)?O.WebGL2:null!==this.canvas.getContext(O.LegacyWebGL)?O.LegacyWebGL:void 0}}class J{constructor(){this.fontAtlas=new Map}hasFontAtlas(t){return this.fontAtlas.has(Symbol.for(t instanceof FontFace?t.family:t))}getFontAtlas(t){return this.fontAtlas.get(Symbol.for(t instanceof FontFace?t.family:t))}getOrCreate(t,e,i){var s;return null!==(s=this.getFontAtlas(e))&&void 0!==s?s:this.create(t,e,i)}create(t,e,i){this.bitmapSize=i,this.chars=[];for(let e=0;e<t.length;e+=2)for(let i=t[e];i<=t[e+1];i++)this.chars.push(String.fromCharCode(i));const s=this.renderAtlas(e instanceof FontFace?e.family:e);return this.fontAtlas.set(Symbol.for(e instanceof FontFace?e.family:e),s),s}renderAtlas(t){const e=new Z(t,this.bitmapSize,Math.ceil(Math.sqrt(this.chars.length))),i=e.canvas.getContext("2d");i.clearRect(0,0,e.canvas.width,e.canvas.height),i.textBaseline="top",i.fillStyle="#000",i.font=`${this.bitmapSize}px ${t}`;let s=0,n=0;for(let t=0;t<this.chars.length;t++)i.fillText(this.chars[t],s,n),e.glyphs.set(this.chars[t],{id:t,width:i.measureText(this.chars[t]).width}),(s+=this.bitmapSize)>e.canvas.width-this.bitmapSize&&(s=0,n+=this.bitmapSize);return e}}class Z{constructor(t,e,i){this.fontFaceFamily=t,this.bitmapFontSize=e,this.gridSize=i,this.canvas=document.createElement("canvas"),this.glyphs=new Map,this.canvas.width=this.gridSize*this.bitmapFontSize,this.canvas.height=this.canvas.width}}class tt{constructor(t,e){this.gl=t,this.shaderLoader=e}create(t,e){const i=this.gl.createProgram(),s=this.shaderLoader.load(this.gl.VERTEX_SHADER,t),n=this.shaderLoader.load(this.gl.FRAGMENT_SHADER,e);this.gl.attachShader(i,s),this.gl.attachShader(i,n),this.gl.linkProgram(i);const r=this.gl.LINK_STATUS;if(!this.gl.getProgramParameter(i,r)){const t=this.gl.getProgramInfoLog(i);throw this.gl.deleteProgram(i),new Error(`Unable to initialize the Program: ${t}`)}return i}}class et{constructor(t,e,i){this.gl=t,this.contextVersion=e,this.programFactory=i}loadProgram(){this.program=this.contextVersion===O.WebGL2?this.programFactory.create("#version 300 es\nprecision mediump float;\n\nin vec2 positionCoords;\nin vec2 textureCoords;\n\nout vec2 texCoords;\n\nuniform mat4 projectionMatrix;\nuniform mat4 modelMatrix;\nuniform mat4 textureMatrix;\n\nvoid main()\n{\n    gl_Position = projectionMatrix * modelMatrix * vec4(positionCoords, 0, 1);\n    texCoords = (textureMatrix * vec4(textureCoords, 0, 1)).xy;\n}","#version 300 es\nprecision mediump float;\n\nout vec4 fragColor;\n\nin vec2 texCoords;\n\nuniform int u_renderTexture;\nuniform sampler2D u_texImage;\nuniform vec4 u_solidColor;\n\nuniform int u_useTintColor;\nuniform vec4 u_tintColor;\n\nuniform int u_useMaskColor;\nuniform vec4 u_maskColor;\nuniform float u_maskColorMix;\n\nuniform float u_alpha;\n\nvoid main()\n{\n    if (u_renderTexture == 1) {\n        vec4 texColor = texture(u_texImage, texCoords);\n\n        if (texColor.a < 0.0001) {\n            discard;\n        }\n\n        if (u_useTintColor == 1) {\n            texColor = u_tintColor * texColor;\n        }\n\n        if (u_useMaskColor == 1) {\n            texColor = mix(texColor, u_maskColor, clamp(u_maskColorMix, 0.0, 1.0));\n        }\n\n        fragColor = vec4(texColor.rgb, u_alpha * texColor.a);        \n    } else {\n        fragColor = vec4(u_solidColor.rgb, u_alpha);\n    }\n}"):this.programFactory.create("precision mediump float;\n\nattribute vec2 positionCoords;\nattribute vec2 textureCoords;\n\nvarying vec2 texCoords;\n\nuniform mat4 projectionMatrix;\nuniform mat4 modelMatrix;\nuniform mat4 textureMatrix;\n\nvoid main()\n{\n    gl_Position = projectionMatrix * modelMatrix * vec4(positionCoords, 0, 1);\n    texCoords = (textureMatrix * vec4(textureCoords, 0, 1)).xy;\n}","precision mediump float;\n\nvarying vec2 texCoords;\n\nuniform int u_renderTexture;\nuniform sampler2D u_texImage;\nuniform vec4 u_solidColor;\n\nuniform int u_useTintColor;\nuniform vec4 u_tintColor;\n\nuniform int u_useMaskColor;\nuniform vec4 u_maskColor;\nuniform float u_maskColorMix;\n\nuniform float u_alpha;\n\nvoid main()\n{\n    if (u_renderTexture == 1) {\n        vec4 texColor = texture2D(u_texImage, texCoords);\n\n        if (texColor.a < 0.0001) {\n            discard;\n        }\n\n        if (u_useTintColor == 1) {\n            texColor = u_tintColor * texColor;\n        }\n\n        if (u_useMaskColor == 1) {\n            texColor = mix(texColor, u_maskColor, clamp(u_maskColorMix, 0.0, 1.0));\n        }\n\n        gl_FragColor = vec4(texColor.rgb, u_alpha * texColor.a);\n    } else {\n        gl_FragColor =  vec4(u_solidColor.rgb, u_alpha);\n    }\n}"),this.positionBuffer=this.gl.createBuffer(),this.textureBuffer=this.gl.createBuffer(),this.positionCoordsAttr=this.gl.getAttribLocation(this.program,"positionCoords"),this.texCoordsAttr=this.gl.getAttribLocation(this.program,"textureCoords"),this.modelMatrixUniform=this.gl.getUniformLocation(this.program,"modelMatrix"),this.projectionMatrixUniform=this.gl.getUniformLocation(this.program,"projectionMatrix"),this.textureMatrixUniform=this.gl.getUniformLocation(this.program,"textureMatrix"),this.renderTextureUniform=this.gl.getUniformLocation(this.program,"u_renderTexture"),this.textureUniform=this.gl.getUniformLocation(this.program,"u_texImage"),this.solidColorUniform=this.gl.getUniformLocation(this.program,"u_solidColor"),this.useTintColorUniform=this.gl.getUniformLocation(this.program,"u_useTintColor"),this.tintColorUniform=this.gl.getUniformLocation(this.program,"u_tintColor"),this.useMaskColorUniform=this.gl.getUniformLocation(this.program,"u_useMaskColor"),this.maskColorUniform=this.gl.getUniformLocation(this.program,"u_maskColor"),this.maskColorMixUniform=this.gl.getUniformLocation(this.program,"u_maskColorMix"),this.alphaUniform=this.gl.getUniformLocation(this.program,"u_alpha"),this.gl.useProgram(this.program),this.gl.blendFunc(this.gl.SRC_ALPHA,this.gl.ONE_MINUS_SRC_ALPHA),this.gl.enableVertexAttribArray(this.positionCoordsAttr),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.positionBuffer),this.gl.vertexAttribPointer(this.positionCoordsAttr,2,this.gl.FLOAT,!1,0,0),this.gl.enableVertexAttribArray(this.texCoordsAttr),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.textureBuffer),this.gl.vertexAttribPointer(this.texCoordsAttr,2,this.gl.FLOAT,!1,0,0)}}class it{constructor(t){this.gl=t}load(t,e){const i=this.gl.createShader(t);this.gl.shaderSource(i,e),this.gl.compileShader(i);const s=this.gl.COMPILE_STATUS;if(!this.gl.getShaderParameter(i,s)){const t=this.gl.getShaderInfoLog(i);throw this.gl.deleteShader(i),new Error(`Unable to initialize the shader program: ${t}`)}return i}}var st,nt="undefined"!=typeof Float32Array?Float32Array:Array;function rt(){var t=new nt(16);return nt!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function ot(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function at(t,e,i){var s,n,r,o,a,h,l,c,d,u,p,g,m=i[0],f=i[1],y=i[2];return e===t?(t[12]=e[0]*m+e[4]*f+e[8]*y+e[12],t[13]=e[1]*m+e[5]*f+e[9]*y+e[13],t[14]=e[2]*m+e[6]*f+e[10]*y+e[14],t[15]=e[3]*m+e[7]*f+e[11]*y+e[15]):(s=e[0],n=e[1],r=e[2],o=e[3],a=e[4],h=e[5],l=e[6],c=e[7],d=e[8],u=e[9],p=e[10],g=e[11],t[0]=s,t[1]=n,t[2]=r,t[3]=o,t[4]=a,t[5]=h,t[6]=l,t[7]=c,t[8]=d,t[9]=u,t[10]=p,t[11]=g,t[12]=s*m+a*f+d*y+e[12],t[13]=n*m+h*f+u*y+e[13],t[14]=r*m+l*f+p*y+e[14],t[15]=o*m+c*f+g*y+e[15]),t}function ht(t,e,i){var s=i[0],n=i[1],r=i[2];return t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t[3]=e[3]*s,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*r,t[9]=e[9]*r,t[10]=e[10]*r,t[11]=e[11]*r,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function lt(t,e,i){var s=Math.sin(i),n=Math.cos(i),r=e[0],o=e[1],a=e[2],h=e[3],l=e[4],c=e[5],d=e[6],u=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=r*n+l*s,t[1]=o*n+c*s,t[2]=a*n+d*s,t[3]=h*n+u*s,t[4]=l*n-r*s,t[5]=c*n-o*s,t[6]=d*n-a*s,t[7]=u*n-h*s,t}function ct(){var t=new nt(3);return nt!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function dt(t,e,i){var s=new nt(3);return s[0]=t,s[1]=e,s[2]=i,s}function ut(){var t=new nt(4);return nt!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)}),ct(),function(){var t;t=new nt(4),nt!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0)}(),ct(),dt(1,0,0),dt(0,1,0),ut(),ut(),st=new nt(9),nt!=Float32Array&&(st[1]=0,st[2]=0,st[3]=0,st[5]=0,st[6]=0,st[7]=0),st[0]=1,st[4]=1,st[8]=1,function(){var t=new nt(2);nt!=Float32Array&&(t[0]=0,t[1]=0)}();const pt=t=>{const e=/^#?([a-f\d]{2})?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[2],16)/256,g:parseInt(e[3],16)/256,b:parseInt(e[4],16)/256,a:void 0!==e[1]?parseInt(e[1],16)/256:1}:null},gt=(t,e,i,s)=>{var n,r;(function(t,e,i,s,n,r,o){var a=1/(e-i),h=1/(s-n);t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*h,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=-1,t[11]=0,t[12]=(e+i)*a,t[13]=(n+s)*h,t[14]=-0,t[15]=1})(t=ot(t),-e.canvas.width/2,e.canvas.width/2,-e.canvas.height/2,e.canvas.height/2),at(t,t,[0,0,0]),s===j.WorldSpace&&ht(t,t,[null!==(n=i.zoom)&&void 0!==n?n:1,null!==(r=i.zoom)&&void 0!==r?r:1,1])};class mt{constructor(t,e){this.gl=t,this.programManager=e,this.vertices=new Map,this.lastVertices=null,this.modelPosition=new K,this.projectionMatrix=rt(),this.modelMatrix=rt(),this.textureMatrix=rt();const i=2*Math.PI/60;this.circumferenceVertices=new Float32Array(((t,e,i=1)=>{const s=[];for(let t=1;t<=e;t+=i)s.push(t);return s})(0,60,1).reduce(((t,e)=>[...t,Math.cos(e*i),Math.sin(e*i)]),[]))}render(t,e,i){switch(t.shape){case C.Polygon:this.renderLines(t,e,this.gl.LINE_LOOP,i);break;case C.Line:this.renderLines(t,e,this.gl.LINES,i);break;case C.Circumference:this.renderCircumference(t,e)}}renderLines(t,e,i,s){var n;const r=this.generateVerticesKey(t.vertexModel);!1===this.vertices.has(r)&&this.vertices.set(r,new Float32Array(this.generatePolygonVertices(t.vertexModel)));const o=this.vertices.get(r);this.lastVertices===r&&s===P.Geometric||(this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.programManager.positionBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,o,this.gl.DYNAMIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.programManager.textureBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,o,this.gl.DYNAMIC_DRAW)),this.lastVertices=r,this.modelMatrix=ot(this.modelMatrix),K.round(this.modelPosition,t.location===j.WorldSpace?K.subtract(this.modelPosition,t.position,e.position):t.position),at(this.modelMatrix,this.modelMatrix,[this.modelPosition.x,this.modelPosition.y,0]),lt(this.modelMatrix,this.modelMatrix,null!==(n=t.rotation)&&void 0!==n?n:0),gt(this.projectionMatrix,this.gl,e,t.location),this.gl.uniformMatrix4fv(this.programManager.projectionMatrixUniform,!1,this.projectionMatrix),this.gl.uniformMatrix4fv(this.programManager.modelMatrixUniform,!1,this.modelMatrix),this.gl.uniformMatrix4fv(this.programManager.textureMatrixUniform,!1,this.textureMatrix),this.gl.uniform1i(this.programManager.renderTextureUniform,0);const{r:a,g:h,b:l,a:c}=pt(t.color);this.gl.uniform4f(this.programManager.solidColorUniform,a,h,l,c),this.gl.uniform1f(this.programManager.alphaUniform,1),this.gl.drawArrays(i,0,o.length/2)}generateVerticesKey(t){return Symbol.for(t.reduce(((t,e)=>`${t}${e.x}${e.y}`),t.length.toString()))}generatePolygonVertices(t){const e=[];for(let i=0;i<t.length;i++)e.push(t[i].x,t[i].y);return e}renderCircumference(t,e){this.lastVertices=null,this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.programManager.positionBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.circumferenceVertices,this.gl.DYNAMIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.programManager.textureBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.circumferenceVertices,this.gl.DYNAMIC_DRAW),this.modelMatrix=ot(this.modelMatrix),K.round(this.modelPosition,t.location===j.WorldSpace?K.subtract(this.modelPosition,t.position,e.position):t.position),at(this.modelMatrix,this.modelMatrix,[this.modelPosition.x,this.modelPosition.y,0]),ht(this.modelMatrix,this.modelMatrix,[t.radius,t.radius,1]),gt(this.projectionMatrix,this.gl,e,t.location),this.gl.uniformMatrix4fv(this.programManager.projectionMatrixUniform,!1,this.projectionMatrix),this.gl.uniformMatrix4fv(this.programManager.modelMatrixUniform,!1,this.modelMatrix),this.gl.uniformMatrix4fv(this.programManager.textureMatrixUniform,!1,this.textureMatrix),this.gl.uniform1i(this.programManager.renderTextureUniform,0);const{r:i,g:s,b:n,a:r}=pt(t.color);this.gl.uniform4f(this.programManager.solidColorUniform,i,s,n,r),this.gl.uniform1f(this.programManager.alphaUniform,1),this.gl.drawArrays(this.gl.LINE_LOOP,0,this.circumferenceVertices.length/2)}}class ft{constructor(t,e){this.gl=t,this.programManager=e,this.type=P.Mask,this.vertices=new Float32Array([-.5,-.5,-.5,.5,.5,-.5,.5,-.5,-.5,.5,.5,.5]),this.modelPosition=new K,this.projectionMatrix=rt(),this.modelMatrix=rt(),this.textureMatrix=rt()}render(t,e,i){var s,n;i!==P.Mask&&(this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.programManager.positionBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.vertices,this.gl.STATIC_DRAW)),this.modelMatrix=ot(this.modelMatrix),K.round(this.modelPosition,t.location===j.WorldSpace?K.subtract(this.modelPosition,t.position,e.position):t.position),at(this.modelMatrix,this.modelMatrix,[this.modelPosition.x,this.modelPosition.y,0]),lt(this.modelMatrix,this.modelMatrix,null!==(s=t.rotation)&&void 0!==s?s:0),ht(this.modelMatrix,this.modelMatrix,[t.width,t.height,1]),gt(this.projectionMatrix,this.gl,e,t.location),this.gl.uniformMatrix4fv(this.programManager.projectionMatrixUniform,!1,this.projectionMatrix),this.gl.uniformMatrix4fv(this.programManager.modelMatrixUniform,!1,this.modelMatrix),this.gl.uniformMatrix4fv(this.programManager.textureMatrixUniform,!1,this.textureMatrix),t.alpha>=0&&t.alpha<1?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this.gl.uniform1i(this.programManager.renderTextureUniform,0);const{r,g:o,b:a,a:h}=pt(t.color);this.gl.uniform4f(this.programManager.solidColorUniform,r,o,a,h),this.gl.uniform1f(this.programManager.alphaUniform,null!==(n=t.alpha)&&void 0!==n?n:1),this.gl.drawArrays(this.gl.TRIANGLES,0,6)}}class yt{constructor(t,e,i){this.gl=t,this.programManager=e,this.textureManager=i,this.lastTexture=null,this.modelPosition=new K,this.projectionMatrix=rt(),this.modelMatrix=rt(),this.textureMatrix=rt(),this.posVertices=new Float32Array([-.5,-.5,-.5,.5,.5,-.5,.5,-.5,-.5,.5,.5,.5]),this.texVertices=new Float32Array([0,1,0,0,1,1,1,1,0,0,1,0])}render(t,e,i){var s,n,r,o;i!==t.type&&(this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.programManager.positionBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.posVertices,this.gl.STATIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.programManager.textureBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,this.texVertices,this.gl.STATIC_DRAW)),this.modelMatrix=ot(this.modelMatrix),K.round(this.modelPosition,t.location===j.WorldSpace?K.subtract(this.modelPosition,t.position,e.position):t.position),at(this.modelMatrix,this.modelMatrix,[this.modelPosition.x,this.modelPosition.y,0]),lt(this.modelMatrix,this.modelMatrix,null!==(s=t.rotation)&&void 0!==s?s:0),ht(this.modelMatrix,this.modelMatrix,[t.width*(t.flipHorizontal?-1:1),t.height*(t.flipVertical?-1:1),1]),this.textureMatrix=ot(this.textureMatrix),t.slice&&(at(this.textureMatrix,this.textureMatrix,[t.slice.x/t.image.naturalWidth,t.slice.y/t.image.naturalHeight,0]),ht(this.textureMatrix,this.textureMatrix,[t.slice.width/t.image.naturalWidth,t.slice.height/t.image.naturalHeight,1])),gt(this.projectionMatrix,this.gl,e,t.location),this.gl.uniformMatrix4fv(this.programManager.projectionMatrixUniform,!1,this.projectionMatrix),this.gl.uniformMatrix4fv(this.programManager.modelMatrixUniform,!1,this.modelMatrix),this.gl.uniformMatrix4fv(this.programManager.textureMatrixUniform,!1,this.textureMatrix),this.gl.enable(this.gl.BLEND);const a=this.textureManager.getOrCreateTextureFromImage(t.image,t.smooth);if(this.lastTexture===a&&i===t.type||(this.gl.bindTexture(this.gl.TEXTURE_2D,a),this.gl.uniform1i(this.programManager.textureUniform,0),this.lastTexture=a),this.gl.uniform1i(this.programManager.renderTextureUniform,1),this.gl.uniform1f(this.programManager.alphaUniform,null!==(n=t.alpha)&&void 0!==n?n:1),this.gl.uniform1i(this.programManager.useTintColorUniform,t.tintColor?1:0),t.tintColor){const{r:e,g:i,b:s,a:n}=pt(t.tintColor);this.gl.uniform4f(this.programManager.tintColorUniform,e,i,s,n)}if(this.gl.uniform1i(this.programManager.useMaskColorUniform,t.maskColor?1:0),t.maskColor){const{r:e,g:i,b:s}=pt(t.maskColor);this.gl.uniform4f(this.programManager.maskColorUniform,e,i,s,null!==(r=t.alpha)&&void 0!==r?r:1),this.gl.uniform1f(this.programManager.maskColorMixUniform,null!==(o=t.maskColorMix)&&void 0!==o?o:1)}this.gl.drawArrays(this.gl.TRIANGLES,0,6)}}var xt;!function(t){t[t.Center=0]="Center",t[t.RightUp=1]="RightUp",t[t.RightDown=2]="RightDown",t[t.RightCenter=3]="RightCenter"}(xt||(xt={}));const vt=new K,bt=new K,Mt=[32,126,161,255],wt=xt.Center;class Ct{constructor(t,e,i,s){this.gl=t,this.programManager=e,this.textureManager=i,this.fontAtlasFactory=s,this.type=P.Text,this.posVertices=[],this.texVertices=[],this.lastTexture=null,this.textSize=new K,this.modelPosition=new K,this.projectionMatrix=rt(),this.modelMatrix=rt(),this.textureMatrix=rt()}render(t,e,i){var s;if(!t.text)return;this.setDefaultValues(t);const n=this.fontAtlasFactory.getOrCreate(t.bitmap.charRanges,t.font,t.bitmap.fontSize);this.generateTextVertices(n,t),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.programManager.positionBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(this.posVertices),this.gl.DYNAMIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.programManager.textureBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(this.texVertices),this.gl.DYNAMIC_DRAW),this.modelMatrix=ot(this.modelMatrix),this.setPositionFromOrientation(t),K.round(this.modelPosition,t.location===j.WorldSpace?K.subtract(this.modelPosition,this.modelPosition,e.position):this.modelPosition),at(this.modelMatrix,this.modelMatrix,[this.modelPosition.x,this.modelPosition.y,0]),lt(this.modelMatrix,this.modelMatrix,null!==(s=t.rotation)&&void 0!==s?s:0),ht(this.modelMatrix,this.modelMatrix,[t.fontSize,t.fontSize,1]),this.textureMatrix=ot(this.textureMatrix),gt(this.projectionMatrix,this.gl,e,t.location),this.gl.uniformMatrix4fv(this.programManager.projectionMatrixUniform,!1,this.projectionMatrix),this.gl.uniformMatrix4fv(this.programManager.modelMatrixUniform,!1,this.modelMatrix),this.gl.uniformMatrix4fv(this.programManager.textureMatrixUniform,!1,this.textureMatrix),t.alpha<1?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND);const r=this.textureManager.getOrCreateTextureFromCanvas(n.fontFaceFamily,n.canvas,t.smooth);this.lastTexture===r&&i===P.Text||(this.gl.bindTexture(this.gl.TEXTURE_2D,r),this.gl.uniform1i(this.programManager.textureUniform,0),this.lastTexture=r),this.gl.uniform1i(this.programManager.useTintColorUniform,0),this.gl.uniform1i(this.programManager.renderTextureUniform,1),this.gl.uniform1f(this.programManager.alphaUniform,t.alpha);const{r:o,g:a,b:h,a:l}=pt(t.color);this.gl.uniform4f(this.programManager.maskColorUniform,o,a,h,l),this.gl.uniform1f(this.programManager.maskColorMixUniform,1),this.gl.uniform1i(this.programManager.useMaskColorUniform,1),this.gl.drawArrays(this.gl.TRIANGLES,0,this.posVertices.length/2)}setDefaultValues(t){var e,i,s,n,r,o,a,h,l,c;t.bitmap?(t.bitmap.margin=null!==(e=t.bitmap.margin)&&void 0!==e?e:vt,t.bitmap.spacing=null!==(i=t.bitmap.spacing)&&void 0!==i?i:bt,t.bitmap.fontSize=null!==(s=t.bitmap.fontSize)&&void 0!==s?s:64,t.bitmap.charRanges=null!==(n=t.bitmap.charRanges)&&void 0!==n?n:Mt):t.bitmap={margin:vt,spacing:bt,fontSize:64,charRanges:Mt},t.color=null!==(r=t.color)&&void 0!==r?r:"#000000",t.letterSpacing=null!==(o=t.letterSpacing)&&void 0!==o?o:0,t.lineSeparation=null!==(a=t.lineSeparation)&&void 0!==a?a:0,t.alpha=null!==(h=t.alpha)&&void 0!==h?h:1,t.orientation=null!==(l=t.orientation)&&void 0!==l?l:wt,t.rotation=null!==(c=t.rotation)&&void 0!==c?c:0}generateTextVertices(t,{text:e,fontSize:i,bitmap:s,letterSpacing:n,lineSeparation:r}){this.posVertices=[],this.texVertices=[];let o=0,a=0,h=0;n/=i,r/=i;for(let i=0;i<e.length;i++){const l=e[i];if("\n"===l){h=Math.max(h,o),o=0,a-=1+r;continue}const c=t.glyphs.get(l);if(c){const e=c.width/t.bitmapFontSize;this.posVertices.push(o,a-1,o+e,a-1,o,a,o,a,o+e,a-1,o+e,a);const i=c.id%t.gridSize*t.bitmapFontSize,r=(c.id/t.gridSize|0)*t.bitmapFontSize,h=(i+s.margin.x)/t.canvas.width,l=(r+s.margin.y)/t.canvas.width,d=(i+c.width+s.spacing.x)/t.canvas.width,u=(r+t.bitmapFontSize+s.spacing.y)/t.canvas.width;this.texVertices.push(h,u,d,u,h,l,h,l,d,u,d,l),o+=e+n}}this.textSize.set(Math.max(h,o)*i,Math.abs(a-1)*i)}setPositionFromOrientation(t){this.modelPosition.set(t.position.x+(t.orientation===xt.Center?-this.textSize.x/2:0),t.position.y+(t.orientation===xt.Center||t.orientation===xt.RightCenter?this.textSize.y/2:t.orientation===xt.RightUp?this.textSize.y:0))}}class jt{constructor(t,e,i){this.gl=t,this.programManager=e,this.textureManager=i,this.posVertices=[],this.texVertices=[],this.lastTexture=null,this.tileset={width:0,tileWidth:0,tileHeight:0,texMargin:new K,texSpacing:new K,texWidth:0,texHeight:0,texCorrection:new K},this.modelPosition=new K,this.projectionMatrix=rt(),this.modelMatrix=rt(),this.textureMatrix=rt()}render(t,e,i){var s,n,r,o;if(this.processTileset(t),this.generateVertices(t),0===this.posVertices.length)return;this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.programManager.positionBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(this.posVertices),this.gl.DYNAMIC_DRAW),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.programManager.textureBuffer),this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(this.texVertices),this.gl.DYNAMIC_DRAW),this.modelMatrix=ot(this.modelMatrix),K.round(this.modelPosition,t.location===j.WorldSpace?K.subtract(this.modelPosition,t.renderPosition,e.position):t.renderPosition),at(this.modelMatrix,this.modelMatrix,[this.modelPosition.x,this.modelPosition.y,0]),lt(this.modelMatrix,this.modelMatrix,null!==(s=t.rotation)&&void 0!==s?s:0),ht(this.modelMatrix,this.modelMatrix,[t.tilemap.tileWidth*(t.flipHorizontal?-1:1),t.tilemap.tileHeight*(t.flipVertical?-1:1),1]),this.textureMatrix=ot(this.textureMatrix),ht(this.textureMatrix,this.textureMatrix,[this.tileset.tileWidth/t.tileset.image.naturalWidth,this.tileset.tileHeight/t.tileset.image.naturalHeight,1]),gt(this.projectionMatrix,this.gl,e,t.location),this.gl.uniformMatrix4fv(this.programManager.projectionMatrixUniform,!1,this.projectionMatrix),this.gl.uniformMatrix4fv(this.programManager.modelMatrixUniform,!1,this.modelMatrix),this.gl.uniformMatrix4fv(this.programManager.textureMatrixUniform,!1,this.textureMatrix),this.gl.enable(this.gl.BLEND);const a=this.textureManager.getOrCreateTextureFromImage(t.tileset.image,t.smooth);if(this.lastTexture===a&&i===P.Tilemap||(this.gl.bindTexture(this.gl.TEXTURE_2D,a),this.gl.uniform1i(this.programManager.textureUniform,0),this.lastTexture=a),this.gl.uniform1i(this.programManager.renderTextureUniform,1),this.gl.uniform1f(this.programManager.alphaUniform,null!==(n=t.alpha)&&void 0!==n?n:1),this.gl.uniform1i(this.programManager.useTintColorUniform,t.tintColor?1:0),t.tintColor){const{r:e,g:i,b:s,a:n}=pt(t.tintColor);this.gl.uniform4f(this.programManager.tintColorUniform,e,i,s,n)}if(this.gl.uniform1i(this.programManager.useMaskColorUniform,t.maskColor?1:0),t.maskColor){const{r:e,g:i,b:s}=pt(t.maskColor);this.gl.uniform4f(this.programManager.maskColorUniform,e,i,s,null!==(r=t.alpha)&&void 0!==r?r:1),this.gl.uniform1f(this.programManager.maskColorMixUniform,null!==(o=t.maskColorMix)&&void 0!==o?o:1)}this.gl.drawArrays(this.gl.TRIANGLES,0,this.posVertices.length/2)}processTileset({tileset:t}){var e,i,s,n,r,o,a;t.margin=null!==(e=t.margin)&&void 0!==e?e:new K,t.spacing=null!==(i=t.spacing)&&void 0!==i?i:new K,t.correction=null!==(s=t.correction)&&void 0!==s?s:new K,this.tileset.width=t.width,this.tileset.tileWidth=t.tileWidth+(null!==(n=t.margin.x)&&void 0!==n?n:0)+(null!==(r=t.spacing.x)&&void 0!==r?r:0),this.tileset.tileHeight=t.tileHeight+(null!==(o=t.margin.y)&&void 0!==o?o:0)+(null!==(a=t.spacing.y)&&void 0!==a?a:0),this.tileset.texMargin.set(t.margin.x/this.tileset.tileWidth,t.margin.y/this.tileset.tileHeight),this.tileset.texSpacing.set(t.spacing.x/this.tileset.tileWidth,t.spacing.y/this.tileset.tileHeight),this.tileset.texCorrection.set(t.correction.x/this.tileset.tileWidth,t.correction.y/this.tileset.tileHeight),this.tileset.texWidth=1-this.tileset.texMargin.x-this.tileset.texSpacing.x-2*this.tileset.texCorrection.x,this.tileset.texHeight=1-this.tileset.texMargin.y-this.tileset.texSpacing.y-2*this.tileset.texCorrection.y}generateVertices({culledTiles:t,tilemap:e}){this.posVertices=[],this.texVertices=[];const i=Math.floor(t.length/e.width);t.forEach(((t,s)=>{if(0===t)return;const n=s%e.width-e.width/2,r=i/2-Math.floor(s/e.width);this.posVertices.push(n,r-1,n+1,r-1,n,r,n,r,n+1,r-1,n+1,r);const o=(t-1)%this.tileset.width+this.tileset.texMargin.x+this.tileset.texCorrection.x,a=Math.floor((t-1)/this.tileset.width)+this.tileset.texMargin.y+this.tileset.texCorrection.y;this.texVertices.push(o,a+this.tileset.texHeight,o+this.tileset.texWidth,a+this.tileset.texHeight,o,a,o,a,o+this.tileset.texWidth,a+this.tileset.texHeight,o+this.tileset.texWidth,a)}))}}class Pt{constructor(t){this.gl=t}createFromImage(t,e=!0,i=null){return i=null!=i?i:this.gl.createTexture(),t.naturalWidth?this.create(t,i,e):t.addEventListener("load",(()=>this.create(t,i,e))),i}createFromCanvas(t,e=!0,i=null){return i=null!=i?i:this.gl.createTexture(),this.create(t,i,e),i}create(t,e,i=!0){this.gl.bindTexture(this.gl.TEXTURE_2D,e),this.gl.texImage2D(this.gl.TEXTURE_2D,0,this.gl.RGBA,this.gl.RGBA,this.gl.UNSIGNED_BYTE,t),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_S,this.gl.CLAMP_TO_EDGE),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_WRAP_T,this.gl.CLAMP_TO_EDGE),!1===i?(this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.NEAREST),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.NEAREST)):(this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MIN_FILTER,this.gl.LINEAR),this.gl.texParameteri(this.gl.TEXTURE_2D,this.gl.TEXTURE_MAG_FILTER,this.gl.LINEAR)),this.gl.bindTexture(this.gl.TEXTURE_2D,null)}}class _t{constructor(t){this.textureFactory=t,this.textures=new Map}getOrCreateTextureFromImage(t,e=!0){var i;return null!==(i=this.textures.get(Symbol.for(t.src)))&&void 0!==i?i:this.createTextureFromImage(t,e)}createTextureFromImage(t,e=!0){const i=this.textureFactory.createFromImage(t,e);return this.textures.set(Symbol.for(t.src),i),i}getOrCreateTextureFromCanvas(t,e,i=!0){var s;return null!==(s=this.textures.get(Symbol.for(t)))&&void 0!==s?s:this.createTextureFromCanvas(t,e,i)}createTextureFromCanvas(t,e,i=!0){const s=this.textureFactory.createFromCanvas(e,i);return this.textures.set(Symbol.for(t),s),s}}class Ot{constructor(t,e,i){this.gl=t,this.renderers=i,e.loadProgram()}render(t,e){this.renderers.get(t.type).render(t,e,this.lastRender),this.lastRender=t.type}clearCanvas(t){const e=pt(t);this.gl.clearColor(e.r,e.g,e.b,e.a),this.gl.clear(this.gl.COLOR_BUFFER_BIT)}}class Rt{constructor(t=0,e=0){this._x=t,this._y=e}get x(){return this._x}set x(t){this._x=t}get y(){return this._y}set y(t){this._y=t}get magnitude(){return Math.sqrt(Math.pow(this._x,2)+Math.pow(this._y,2))}set(t,e){this._x=t,this._y=e}copy(t){this.set(t.x,t.y)}equals(t){return this._x===t.x&&this._y===t.y}clone(){return new Rt(this._x,this._y)}distance(t){return Math.sqrt(Math.pow(this._x-t.x,2)+Math.pow(this._y-t.y,2))}static add(t,e,i){return t.set(e.x+i.x,e.y+i.y),t}static subtract(t,e,i){return t.set(e.x-i.x,e.y-i.y),t}static unit(t,e){return 0===e.magnitude?t.set(0,0):t.set(e.x/e.magnitude,e.y/e.magnitude),t}static normal(t,e){return t.set(-e.y,e.x),this.unit(t,t)}static scale(t,e,i){return t.set(e.x*i,e.y*i),t}static dot(t,e){return t.x*e.x+t.y*e.y}static cross(t,e){return t.x*e.y-t.y*e.x}static round(t,e){return t.set(Math.round(e.x),Math.round(e.y)),t}}class St{constructor(t,e,i,s){this._position=new Rt,this._center=new Rt,this._width=0,this._height=0,this.set(t,e,i,s)}get x(){return this._position.x}set x(t){this._position.set(t,this._position.y)}get y(){return this._position.y}set y(t){this._position.set(this._position.x,t)}get x1(){return this._position.x+this._width}get y1(){return this._position.y+this._height}get position(){return this._position}set position(t){this._position.set(t.x,t.y)}get width(){return this._width}set width(t){this._width=t}get height(){return this._height}set height(t){this._height=t}get center(){return this._center.set(this.x+this.width/2,this.y+this.height/2),this._center}set(t,e,i,s){this._position.set(t,e),this._width=i,this._height=s}equals(t){return this.position.equals(t.position)&&this.width===t.width&&this.height===t.height}copy(t){this.set(t.x,t.y,t.width,t.height)}overlaps(t){return this.x1>=t.x&&this.x<t.x1&&this.y1>=t.y&&this.y<t.y1}contains(t){return t instanceof St?t.x1<=this.x1&&t.x>=this.x&&t.y1<=this.y1&&t.y>=this.y:t instanceof Rt&&!(t.x<this.x||t.y<this.y||t.x>=this.x1||t.y>=this.y1)}}const At=(t,e,i)=>Math.min(i,Math.max(e,t));class Tt{constructor(){this.lastId=0}create({shape:t,layer:e,updateCollisions:i,physics:s,position:n,rotation:r,group:o,onCollision:a}){return{id:++this.lastId,active:!0,layer:e,shape:t,updateCollisions:i,physics:s,position:null!=n?n:new Rt,rotation:null!=r?r:0,group:o,onCollision:a}}}class Dt{constructor(t,e=0){this.area=new St(0,0,0,0),this.depth=0,this.items=[],this.children=[],this.depth=e,this.resize(t)}resize(t){this.clear(),this.area.copy(t)}clear(){this.items=[],this.children.forEach((t=>t.clear())),this.children=[]}insert(t,e){0===this.children.length&&this.items.length>16&&this.depth<8&&this.split(),this.children.length>0?this.insertItemIntoChildren(t,e):this.items.push([t,e])}split(){const t=this.area.width/2,e=this.area.height/2;this.children=[new St(this.area.x,this.area.y,t,e),new St(this.area.x,this.area.y+e,t,e),new St(this.area.x+t,this.area.y+e,t,e),new St(this.area.x+t,this.area.y,t,e)].map((t=>new Dt(t,this.depth+1))),this.items.forEach((t=>this.insertItemIntoChildren(t[0],t[1]))),this.items=[]}insertItemIntoChildren(t,e){this.getChildrenForArea(e).forEach((i=>i.insert(t,e)))}retrieve(t){const e=[];return this.children.length>0?this.getChildrenForArea(t).forEach((i=>e.push(...i.retrieve(t)))):this.items.forEach((t=>e.push(t[0]))),e}getChildrenForArea(t){const e=[];return t.x<=this.area.center.x&&t.y<=this.area.center.y&&e.push(this.children[0]),t.x<=this.area.center.x&&t.y1>=this.area.center.y&&e.push(this.children[1]),t.x1>=this.area.center.x&&t.y1>=this.area.center.y&&e.push(this.children[2]),t.x1>=this.area.center.x&&t.y<=this.area.center.y&&e.push(this.children[3]),e}}const Ft=(t,e,i,s)=>Math.min((t-e)/i|0,s-1);class Et{constructor(t){this.coordinates={x0:0,x1:0,y0:0,y1:0},this._subdivisions=1,this.resize(t)}get subdivisions(){return this._subdivisions}set subdivisions(t){this._subdivisions=At(t,1,20)}resize(t){this.area=t,this.cellWidth=Math.ceil(t.width/this._subdivisions),this.cellHeight=Math.ceil(t.height/this._subdivisions),this.itemsInCells=[];for(let t=0;t<this._subdivisions;t++){this.itemsInCells[t]=[];for(let e=0;e<this._subdivisions;e++)this.itemsInCells[t][e]=[]}}clear(){for(let t=0;t<this._subdivisions;t++)for(let e=0;e<this._subdivisions;e++)this.itemsInCells[t][e]=[]}insert(t,e){this.updateCoordinates(e);for(let e=this.coordinates.x0;e<=this.coordinates.x1;e++)for(let i=this.coordinates.y0;i<=this.coordinates.y1;i++)this.itemsInCells[e][i].push(t)}retrieve(t){const e=[];this.updateCoordinates(t);for(let t=this.coordinates.x0;t<=this.coordinates.x1;t++)for(let i=this.coordinates.y0;i<=this.coordinates.y1;i++)this.itemsInCells[t][i].forEach((t=>e.includes(t)?null:e.push(t)));return e}updateCoordinates(t){this.coordinates.x0=Ft(t.x,this.area.x,this.cellWidth,this._subdivisions),this.coordinates.x1=Ft(t.x1,this.area.x,this.cellWidth,this._subdivisions),this.coordinates.y0=Ft(t.y,this.area.y,this.cellHeight,this._subdivisions),this.coordinates.y1=Ft(t.y1,this.area.y,this.cellHeight,this._subdivisions)}}var Bt,It,Ut,Gt;!function(t){t[t.QuadTree=0]="QuadTree",t[t.SpartialGrid=1]="SpartialGrid"}(Bt||(Bt={}));class Lt{constructor(t,e,i,s){this.collisions=[],this.lastCollidersAmount=0,this.minArea=new Rt,this.maxArea=new Rt,this.newArea=new St(0,0,0,0),this.method=t,this.colliders=[],this.activeColliders=[],this.collisionMatrix=s,this.setupBroadPhaseResolver(null!=e?e:Bt.QuadTree,i)}setupBroadPhaseResolver(t,e){this.collisionArea=null!=e?e:new St(0,0,0,0),this.fixedCollisionArea=!!e,t===Bt.SpartialGrid?this.broadPhaseResolver=new Et(this.collisionArea):this.broadPhaseResolver=new Dt(this.collisionArea)}addCollider(t){this.colliders[t.id]=t}getCollider(t){return this.colliders[t]}removeCollider(t){delete this.colliders[t.id]}clearColliders(){this.colliders=[]}getCollisionsForCollider(t){return t.active?this.collisions.filter((e=>e.localCollider.id===t.id)):[]}refreshCollisionsForCollider(t){this.colliders[t.id]&&t.active&&(this.collisions=this.collisions.filter((e=>e.localCollider.id!==t.id&&e.remoteCollider.id!==t.id)),this.updateShape(t),this.narrowPhase(t,this.broadPhase(t)))}resolve(){this.collisions=[],0!==this.colliders.length&&(this.activeColliders=this.colliders.filter((t=>t.active)),this.broadPhaseResolver.clear(),this.activeColliders.forEach((t=>{this.updateShape(t)})),!1===this.fixedCollisionArea&&(this.updateNewArea(),!1===this.newArea.equals(this.collisionArea)&&(this.collisionArea.copy(this.newArea),this.broadPhaseResolver.resize(this.collisionArea))),this.checkForSpartialGridResize(),this.activeColliders.forEach((({id:t,shape:{boundingBox:e}})=>this.broadPhaseResolver.insert(t,e))),this.updateCollisions())}updateShape(t){t.shape.position=t.position,t.shape.rotation=t.rotation,t.shape.update()}updateNewArea(){this.activeColliders.forEach((({shape:{boundingBox:t}})=>{this.minArea.set(Math.min(t.x,this.minArea.x),Math.min(t.y,this.minArea.y)),this.maxArea.set(Math.max(t.x1,this.maxArea.x),Math.max(t.y1,this.maxArea.y))})),this.newArea.set(this.minArea.x,this.minArea.y,this.maxArea.x-this.minArea.x,this.maxArea.y-this.minArea.y)}checkForSpartialGridResize(){this.broadPhaseResolver instanceof Et&&this.lastCollidersAmount!==this.activeColliders.length&&(this.broadPhaseResolver.subdivisions=1+(this.activeColliders.length/10|0),this.broadPhaseResolver.resize(this.collisionArea),this.lastCollidersAmount=this.activeColliders.length)}updateCollisions(){this.activeColliders.filter((t=>t.updateCollisions)).forEach((t=>this.narrowPhase(t,this.broadPhase(t))))}broadPhase(t){return this.collisionMatrix?this.broadPhaseResolver.retrieve(t.shape.boundingBox).map((t=>this.colliders[t])).filter((e=>this.collisionMatrix.some((i=>i[0]===t.layer&&i[1]===e.layer||i[1]===t.layer&&i[0]===e.layer)))):this.broadPhaseResolver.retrieve(t.shape.boundingBox).map((t=>this.colliders[t]))}narrowPhase(t,e){e.filter((e=>!(t.group&&e.group&&e.group===t.group||t.id===e.id))).forEach((e=>{if(this.isResolved(t,e))return;const i=this.method.getCollisionResolution(t.shape,e.shape);null!==i&&(this.collisions.push({localCollider:t,remoteCollider:e,resolution:i},{localCollider:e,remoteCollider:t,resolution:{direction:i.displacementDirection,displacementDirection:i.direction,penetration:i.penetration}}),t.onCollision&&t.onCollision(i))}))}isResolved(t,e){for(const i of this.collisions)if(i.localCollider.id===t.id&&i.remoteCollider.id===e.id)return!0;return!1}}!function(t){t[t.Polygon=0]="Polygon",t[t.Circumference=1]="Circumference",t[t.Line=2]="Line"}(It||(It={}));class kt{constructor(t,e,i){this.AABBResolver=t,this.circumferenceAABBResolver=e,this.circumferenceResolver=i}getCollisionResolution(t,e){return t.type===It.Polygon&&e.type===It.Polygon?this.AABBResolver.resolve(t,e):t.type===It.Circumference&&e.type===It.Polygon?this.circumferenceAABBResolver.resolve(t,e):t.type===It.Polygon&&e.type===It.Circumference?this.circumferenceAABBResolver.resolve(e,t,!0):t.type===It.Circumference&&e.type===It.Circumference?this.circumferenceResolver.resolve(t,e):null}}!function(t){t[t.AABB=0]="AABB",t[t.SAT=1]="SAT"}(Ut||(Ut={}));class Wt{constructor(t,e){this.circumferenceResolver=t,this.satResolver=e}getCollisionResolution(t,e){return t.type===It.Circumference&&e.type===It.Circumference?this.circumferenceResolver.resolve(t,e):this.satResolver.resolve(t,e)}}class Vt{constructor(){this.direction=new Rt,this.displacementDirection=new Rt}resolve({boundingBox:t},{boundingBox:e}){return this.overlapX=Math.min(t.x1,e.x1)-Math.max(t.x,e.x),this.overlapY=Math.min(t.y1,e.y1)-Math.max(t.y,e.y),this.overlapX<0||this.overlapY<0?null:(this.checkOverlapForLines(t,e),this.direction.set(Math.sign(e.center.x-t.center.x),Math.sign(e.center.y-t.center.y)),this.preventContainment(t,e),this.overlapY<this.overlapX?(this.minOverlap=this.overlapY,this.displacementDirection.set(0,-this.direction.y)):(this.minOverlap=this.overlapX,this.displacementDirection.set(-this.direction.x,this.overlapY===this.overlapX?-this.direction.y:0)),Rt.unit(this.displacementDirection,this.displacementDirection),{direction:Rt.scale(new Rt,this.displacementDirection,-1),displacementDirection:this.displacementDirection.clone(),penetration:this.minOverlap})}checkOverlapForLines(t,e){0!==t.width&&0!==e.width||0!==this.overlapX||(this.overlapX=Math.min(Math.abs(t.x-e.x),Math.abs(t.x1-e.x1))),0!==t.height&&0!==e.height||0!==this.overlapY||(this.overlapY=Math.min(Math.abs(t.y-e.y),Math.abs(t.y1-e.y1)))}preventContainment(t,e){if(this.overlapY>0&&(t.y1>e.y1&&t.y<e.y||t.y1<e.y1&&t.y>e.y)){const i=Math.abs(t.y-e.y),s=Math.abs(t.y1-e.y1);this.overlapY+=i<s?i:s}if(this.overlapX>0&&(t.x1>e.x1&&t.x<e.x||t.x1<e.x1&&t.x>e.x)){const i=Math.abs(t.x-e.x),s=Math.abs(t.x1-e.x1);this.overlapX+=i<s?i:s}}}class Ht{constructor(){this.closestPoint=new Rt,this.distance=new Rt,this.direction=new Rt}resolve(t,e,i=!1){return this.closestPoint.set(At(t.position.x,e.boundingBox.x,e.boundingBox.x1),At(t.position.y,e.boundingBox.y,e.boundingBox.y1)),Rt.subtract(this.distance,this.closestPoint,t.position),this.distance.magnitude>t.radius?null:(Rt.unit(this.direction,this.distance),{direction:i?Rt.scale(new Rt,this.direction,-1):this.direction.clone(),displacementDirection:i?this.direction.clone():Rt.scale(new Rt,this.direction,-1),penetration:t.radius-this.distance.magnitude})}}class zt{constructor(){this.distance=new Rt,this.direction=new Rt}resolve(t,e){return Rt.subtract(this.distance,e.position,t.position),this.distance.magnitude>t.radius+e.radius?null:(Rt.unit(this.direction,this.distance),{direction:this.direction.clone(),displacementDirection:Rt.scale(new Rt,this.direction,-1),penetration:t.radius+e.radius-this.distance.magnitude})}}class Yt{constructor(){this.projA={min:0,max:0},this.projB={min:0,max:0},this.smallestAxis=new Rt,this.distance=new Rt(1/0,1/0),this.cache=new Rt}resolve(t,e){this.minOverlap=1/0,t.type===It.Circumference?this.setCircumferenceAxis(t,e):e.type===It.Circumference&&this.setCircumferenceAxis(e,t),this.axes=[...t.projectionAxes],e.projectionAxes.forEach((t=>this.axes.some((e=>e.equals(t)))?null:this.axes.push(t)));for(let i=0;i<this.axes.length;i++){if(t.type===It.Circumference?this.setCircumferenceVertices(t,this.axes[i]):e.type===It.Circumference&&this.setCircumferenceVertices(e,this.axes[i]),this.projectShapeOntoAxis(this.projA,t,this.axes[i]),this.projectShapeOntoAxis(this.projB,e,this.axes[i]),this.currentOverlap=Math.min(this.projA.max,this.projB.max)-Math.max(this.projA.min,this.projB.min),this.currentOverlap<0)return null;if(this.invertAxis=!0,this.projA.max>this.projB.max&&this.projA.min<this.projB.min||this.projA.max<this.projB.max&&this.projA.min>this.projB.min){const t=Math.abs(this.projA.min-this.projB.min),e=Math.abs(this.projA.max-this.projB.max);t<e?this.currentOverlap+=t:(this.currentOverlap+=e,Rt.scale(this.axes[i],this.axes[i],-1),this.invertAxis=!1)}this.currentOverlap<this.minOverlap&&(this.minOverlap=this.currentOverlap,this.smallestAxis.copy(this.axes[i]),this.invertAxis&&this.projA.max<this.projB.max&&Rt.scale(this.smallestAxis,this.axes[i],-1))}return{direction:Rt.scale(new Rt,this.smallestAxis,-1),displacementDirection:this.smallestAxis.clone(),penetration:this.minOverlap}}projectShapeOntoAxis(t,e,i){return t.min=1/0,t.max=-1/0,e.vertices.forEach((e=>{t.min=Math.min(Rt.dot(i,e),t.min),t.max=Math.max(Rt.dot(i,e),t.max)})),t}setCircumferenceAxis(t,e){this.distance.set(1/0,1/0),e.vertices.forEach((e=>{Rt.subtract(this.cache,e,t.position),this.cache.magnitude<this.distance.magnitude&&this.distance.copy(this.cache)})),Rt.unit(t.projectionAxes[0],this.distance)}setCircumferenceVertices(t,e){Rt.add(t.vertices[0],t.position,Rt.scale(this.cache,Rt.unit(this.cache,e),-t.radius)),Rt.add(t.vertices[1],t.position,Rt.scale(this.cache,Rt.unit(this.cache,e),t.radius))}}class Xt{constructor(t,e,i,s){this.collisionManager=t,this.colliderFactory=e,this.rigidBodyManager=i,this.rigidBodyFactory=s}addCollider(t){const e=this.colliderFactory.create(t);return this.collisionManager.addCollider(e),e}removeCollider(t){this.collisionManager.removeCollider(t)}getCollisionsForCollider(t){return this.collisionManager.getCollisionsForCollider(t)}addRigidBody(t){const e=this.rigidBodyFactory.create(t);return this.rigidBodyManager.addRigidBody(e),e}removeRigidBody(t){this.rigidBodyManager.removeRigidBody(t)}resolve(t){this.collisionManager.resolve(),this.rigidBodyManager.resolve(t)}clear(){this.collisionManager.clearColliders(),this.rigidBodyManager.clearRigidBodies()}}class Nt{constructor(){this.lastId=0}create({colliderIds:t,type:e,gravity:i,position:s,velocity:n,onResolve:r}){if(0===t.length)throw new Error("RigidBody needs at least one collider");return{id:++this.lastId,active:!0,colliderIds:t,type:e,gravity:null!=i?i:0,position:null!=s?s:new Rt,velocity:null!=n?n:new Rt,onResolve:r}}}!function(t){t[t.Static=0]="Static",t[t.Dynamic=1]="Dynamic",t[t.Kinematic=2]="Kinematic"}(Gt||(Gt={}));const qt=["x","y"];class Kt{constructor(t){this.collisionManager=t,this.rigidBodies=[],this.activeRigidBodies=[],this.colliders=[],this.velocity=new Rt,this.displacement=new Rt,this.cacheDisplacement=0}addRigidBody(t){this.rigidBodies[t.id]=t}removeRigidBody(t){delete this.rigidBodies[t.id]}clearRigidBodies(){this.rigidBodies=[]}resolve(t){this.activeRigidBodies=this.rigidBodies.filter((t=>t.active)),this.colliders=this.activeRigidBodies.reduce(((t,e)=>[...t,...e.colliderIds]),[]),this.activeRigidBodies.forEach((e=>{e.type===Gt.Dynamic?this.dynamicUpdate(e,t):e.type===Gt.Kinematic&&this.kinematicUpdate(e,t),e.onResolve&&e.onResolve(e)}))}dynamicUpdate(t,e){this.applyGravity(t,e),qt.forEach((i=>{this.applyVelocity(t,e,i),this.obtainDisplacement(t,i),this.applyReposition(t,i)}))}kinematicUpdate(t,e){Rt.add(t.position,t.position,Rt.scale(this.velocity,t.velocity,e)),t.colliderIds.map((t=>this.collisionManager.getCollider(t))).forEach((t=>{Rt.add(t.position,t.position,this.velocity),this.collisionManager.refreshCollisionsForCollider(t)}))}applyGravity(t,e){t.gravity>0&&(t.velocity.y-=t.gravity*e)}applyVelocity(t,e,i){this.velocity[i]=t.velocity[i]*e,0!==this.velocity[i]&&(t.position[i]+=this.velocity[i],t.colliderIds.map((t=>this.collisionManager.getCollider(t))).forEach((t=>{t.position[i]+=this.velocity[i],this.collisionManager.refreshCollisionsForCollider(t)})))}obtainDisplacement(t,e){this.displacement[e]=0,this.getCollisions(t).forEach((t=>{this.cacheDisplacement=t.resolution.displacementDirection[e]*t.resolution.penetration,this.displacement[e]=Math.abs(this.displacement[e])>Math.abs(this.cacheDisplacement)?this.displacement[e]:this.cacheDisplacement}))}applyReposition(t,e){0!==this.displacement[e]&&(t.position[e]+=this.displacement[e],t.colliderIds.map((t=>this.collisionManager.getCollider(t))).forEach((t=>{t.position[e]+=this.displacement[e],this.collisionManager.refreshCollisionsForCollider(t)})),Math.sign(this.displacement[e])!==Math.sign(t.velocity[e])&&(t.velocity[e]=0))}getCollisions(t){return t.colliderIds.map((t=>this.collisionManager.getCollider(t))).filter((t=>t.active&&t.physics)).reduce(((t,e)=>(t.push(...this.collisionManager.getCollisionsForCollider(e).filter((t=>t.remoteCollider.physics&&this.colliders.includes(t.remoteCollider.id)))),t)),[])}}class $t{constructor(t){this.radius=t,this.type=It.Circumference,this.boundingBox=new St(0,0,0,0),this.vertices=[new Rt,new Rt],this.projectionAxes=[new Rt],this._position=new Rt}set position(t){this._position.copy(t)}get position(){return this._position}update(){this.updateBoundingBox()}updateBoundingBox(){this.boundingBox.set(this.position.x-this.radius,this.position.y-this.radius,2*this.radius,2*this.radius)}}class Qt{constructor(t){this.vertexModel=t,this.type=It.Polygon,this.vertices=[new Rt,new Rt],this.projectionAxes=[new Rt],this.boundingBox=new St(0,0,0,0),this.rotation=0,this._position=new Rt}update(){this.updateVertices(),this.updateBoundingBox(),this.updateProjectionAxes()}set position(t){this._position.copy(t)}get position(){return this._position}updateVertices(){for(let t=0;t<this.vertexModel.length;t++)this.vertices[t].set(this.vertexModel[t].x*Math.cos(this.rotation)-this.vertexModel[t].y*Math.sin(this.rotation)+this._position.x,this.vertexModel[t].x*Math.sin(this.rotation)+this.vertexModel[t].y*Math.cos(this.rotation)+this._position.y)}updateBoundingBox(){this.boundingBox.x=Math.min(this.vertices[0].x,this.vertices[1].x),this.boundingBox.y=Math.min(this.vertices[0].y,this.vertices[1].y),this.boundingBox.width=Math.max(this.vertices[0].x,this.vertices[1].x)-this.boundingBox.x,this.boundingBox.height=Math.max(this.vertices[0].y,this.vertices[1].y)-this.boundingBox.y}updateProjectionAxes(){Rt.normal(this.projectionAxes[0],Rt.subtract(this.projectionAxes[0],this.vertices[1],this.vertices[0]))}}class Jt{constructor(t){this.vertexModel=t,this.type=It.Polygon,this.vertices=[],this.boundingBox=new St(0,0,0,0),this.rotation=0,this._projectionAxes=[],this._position=new Rt,this.boxMinX=Number.MAX_SAFE_INTEGER,this.boxMinY=Number.MAX_SAFE_INTEGER,this.boxMaxX=-Number.MAX_SAFE_INTEGER,this.boxMaxY=-Number.MAX_SAFE_INTEGER;for(let t=0;t<this.vertexModel.length;t++)this.vertices.push(new Rt),this._projectionAxes.push(new Rt)}set position(t){this._position.copy(t)}get position(){return this._position}get projectionAxes(){return this._projectionAxes}update(){this.updateVertices(),this.updateBoundingBox(),this.updateProjectionAxes()}updateVertices(){for(let t=0;t<this.vertexModel.length;t++)this.vertices[t].set(this.vertexModel[t].x*Math.cos(this.rotation)-this.vertexModel[t].y*Math.sin(this.rotation)+this._position.x,this.vertexModel[t].x*Math.sin(this.rotation)+this.vertexModel[t].y*Math.cos(this.rotation)+this._position.y)}updateBoundingBox(){this.boxMinX=this.vertices[0].x,this.boxMinY=this.vertices[0].y,this.boxMaxX=this.vertices[0].x,this.boxMaxY=this.vertices[0].y,this.vertices.forEach((t=>{this.boxMinX=Math.min(t.x,this.boxMinX),this.boxMinY=Math.min(t.y,this.boxMinY),this.boxMaxX=Math.max(t.x,this.boxMaxX),this.boxMaxY=Math.max(t.y,this.boxMaxY)})),this.boundingBox.set(this.boxMinX,this.boxMinY,this.boxMaxX-this.boxMinX,this.boxMaxY-this.boxMinY)}updateProjectionAxes(){var t;for(let e=0;e<this.vertices.length;e++)Rt.normal(this._projectionAxes[e],Rt.subtract(this._projectionAxes[e],null!==(t=this.vertices[e+1])&&void 0!==t?t:this.vertices[0],this.vertices[e]))}}class Zt extends Jt{constructor(t,e){super([new Rt(-t/2,-e/2),new Rt(-t/2,e/2),new Rt(t/2,e/2),new Rt(t/2,-e/2)]),this.width=t,this.height=e,this._projectionAxes=[new Rt,new Rt]}updateSize(t,e){this.width=t,this.height=e,this.vertexModel[0].set(-t/2,-e/2),this.vertexModel[1].set(-t/2,e/2),this.vertexModel[2].set(t/2,e/2),this.vertexModel[3].set(t/2,-e/2)}updateProjectionAxes(){Rt.unit(this.projectionAxes[0],Rt.subtract(this.projectionAxes[0],this.vertices[1],this.vertices[0])),Rt.normal(this.projectionAxes[1],this.projectionAxes[0])}}var te,ee=function(t){var e=t.getSingleton("DomManager");t.add("InputManager",(function(){return new E(new I(e.canvas),new B(e.canvas),new D,new k(e.canvas))}))},ie=function(t,e){e.headless||(W.initialize(t.getSingleton("AssetManager")),V.initialize(t.getSingleton("DomManager")),H.initialize(t.getSingleton("InputManager"))),z.initialize(t.getSingleton("SceneManager")),Y.initialize(t.getSingleton("TimeManager")),X.initialize(t.getSingleton("GameObjectManager"))},se=function(){function t(){this.instances=new Map,this.constructors=new Map,this.constants=new Map}return t.prototype.add=function(t,e){if(this.constructors.has(t))throw new S("There is already an object constructor with the name ".concat(t));this.constructors.set(t,e)},t.prototype.getSingleton=function(t){if(!1===this.constructors.has(t))throw new S("Invalid object constructor name: ".concat(t));return!1===this.instances.has(t)&&this.instances.set(t,this.constructors.get(t)()),this.instances.get(t)},t.prototype.getTranscient=function(t){if(!1===this.constructors.has(t))throw new S("Invalid object constructor name: ".concat(t));return this.constructors.get(t)()},t.prototype.addConstant=function(t,e){if(this.constants.has(t))throw new S("There is already a constant value with the name ".concat(t));this.constants.set(t,e)},t.prototype.getConstant=function(t){if(!1===this.constants.has(t))throw new S("Invalid constant name: ".concat(t));return this.constants.get(t)},t}(),ne={containerNode:null,gameWidth:320,gameHeight:180,debugEnabled:!1,canvasColor:"#000000",physicsFramerate:180,headless:!1,spriteDefaultScale:new t(1,1),collisions:{collisionMethod:Ut.SAT,collisionBroadPhaseMethod:Bt.SpartialGrid}},re=function(){function t(t){this._config=h(h({},ne),t),this._config.collisions=h(h({},ne.collisions),t.collisions),this.container=new se,this.container.addConstant("Game",this),this.setupManagers()}return t.prototype.setupManagers=function(){(function(t,e){t.addConstant("GameConfig",e),t.add("TimeManager",(function(){return new L(e.physicsFramerate)})),t.add("GameObjectManager",(function(){return new T(t)})),t.add("PhysicsManager",(function(){return(({collisionArea:t,collisionMatrix:e,collisionMethod:i,collisionBroadPhaseMethod:s}={})=>{const n=new zt,r=i===Ut.AABB?new kt(new Vt,new Ht,n):new Wt(n,new Yt),o=new Lt(r,s,t,e),a=new Tt,h=new Kt(o),l=new Nt;return new Xt(o,a,h,l)})(e.collisions)})),e.headless?t.add("IterationManager",(function(){return new N(t.getSingleton("TimeManager"),t.getSingleton("PhysicsManager"),t.getSingleton("GameObjectManager"),t.getSingleton("SceneManager"))})):(t.add("DomManager",(function(){return new A(e.containerNode,e.gameWidth,e.gameHeight)})),t.add("RenderManager",(function(){return(t=>{const e=new Q(t),i=e.gl,s=e.contextVersion,n=new et(i,s,new tt(i,new it(i))),r=new _t(new Pt(i)),o=new Ot(i,n,new Map([[P.Sprite,new yt(i,n,r)],[P.Text,new Ct(i,n,r,new J)],[P.Tilemap,new jt(i,n,r)],[P.Geometric,new mt(i,n)],[P.Mask,new ft(i,n)]]));return new $(o,new q(i))})(t.getSingleton("DomManager").canvas)})),ee(t),t.add("AssetManager",(function(){return new R})),t.add("IterationManager",(function(){return new p(t.getSingleton("TimeManager"),t.getSingleton("PhysicsManager"),t.getSingleton("RenderManager"),t.getSingleton("InputManager"),t.getSingleton("GameObjectManager"),t.getSingleton("SceneManager"),e.canvasColor)}))),t.add("SceneManager",(function(){return new U(t,e.headless?void 0:t.getSingleton("RenderManager"))})),ie(t,e)})(this.container,this._config),this.sceneManager=this.container.getSingleton("SceneManager"),this.iterationManager=this.container.getSingleton("IterationManager")},Object.defineProperty(t.prototype,"config",{get:function(){return this._config},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"running",{get:function(){return this.iterationManager.running},enumerable:!1,configurable:!0}),t.prototype.addScene=function(t,e,i,s){void 0===s&&(s=!1),this.sceneManager.addScene(t,e,i,s)},t.prototype.run=function(){this.iterationManager.start()},t.prototype.stop=function(){this.iterationManager.stop()},t.prototype.pause=function(){this.iterationManager.pause()},t.prototype.resume=function(){this.iterationManager.resume()},t}(),oe=function(e){function i(){var i=null!==e&&e.apply(this,arguments)||this;return i.allowMultiple=!1,i.parentScale=!0,i.parentRotation=!0,i._position=new t,i._scale=new t(1,1),i._rotation=new r,i._innerPosition=new t,i._parent=null,i.cache=new t,i.lastParentRadians=0,i.lastPosition=new t,i.scaledInnerPosition=new t,i}return a(i,e),Object.defineProperty(i.prototype,"position",{get:function(){return this._position},set:function(t){this._position.copy(t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"scale",{get:function(){return this._scale},set:function(t){this._scale.copy(t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"rotation",{get:function(){return this._rotation},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"direction",{get:function(){return this._rotation.direction},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"innerPosition",{get:function(){return this._innerPosition},set:function(t){this._innerPosition.copy(t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"parent",{get:function(){return this._parent},set:function(e){this._parent=e,null!==this._parent&&t.subtract(this._innerPosition,this._position,this._parent.position)},enumerable:!1,configurable:!0}),i.prototype.update=function(){null!==this._parent&&this.setPositionFromParent(),this.lastPosition.copy(this._position)},i.prototype.setPositionFromParent=function(){this._innerPosition.magnitude>0?(0!==this._parent.rotation.radians&&this.lastParentRadians!==this._parent.rotation.radians&&(this.translateInnerPosition(),this.lastParentRadians=this._parent.rotation.radians),this.parentScale?(this.updateScaledInnerPosition(),t.add(this._position,this._parent.position,this.scaledInnerPosition)):t.add(this._position,this._parent.position,this._innerPosition)):this._position.copy(this._parent.position),this._rotation.radians=this.parentRotation?this._parent.rotation.radians+this._rotation.radians:this._rotation.radians,this.parentScale&&this._scale.copy(this._parent.scale)},i.prototype.translateInnerPosition=function(){var e=Math.atan2(this._innerPosition.y,this._innerPosition.x)+(this._parent.rotation.radians-this.lastParentRadians);this.cache.set(Math.cos(e),Math.sin(e)),t.scale(this._innerPosition,this.cache,this._innerPosition.magnitude)},i.prototype.updateScaledInnerPosition=function(){this.scaledInnerPosition.set(this._innerPosition.x*this._parent.scale.x,this._innerPosition.y*this._parent.scale.y)},i}(v),ae=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.physicsManager=e.container.getSingleton("PhysicsManager"),e.renderer=null,e.colliders=[],e.physics=!0,e}return a(e,t),e.prototype.collidesWithLayer=function(t){return null!==this.getCollisionWithLayer(t)},e.prototype.getCollisionWithLayer=function(t){for(var e=0,i=this.colliders;e<i.length;e++)for(var s=i[e],n=0,r=this.physicsManager.getCollisionsForCollider(s);n<r.length;n++){var o=r[n];if(o.remoteCollider.layer===t)return this.createCollisionData(o)}return null},e.prototype.getCollisionsWithLayer=function(t){for(var e=[],i=0,s=this.colliders;i<s.length;i++)for(var n=s[i],r=0,o=this.physicsManager.getCollisionsForCollider(n);r<o.length;r++){var a=o[r];a.remoteCollider.layer===t&&e.push(this.createCollisionData(a))}return e},e.prototype.createCollisionData=function(t){return{gameObject:this.gameObjectManager.findGameObjectById(t.remoteCollider.group),collider:t.remoteCollider,resolution:t.resolution,getGameObject:function(){return this.gameObject}}},e.prototype.onActiveChange=function(){var t=this;this.renderer&&(this.renderer.active=this.active),this.colliders.forEach((function(e){return e.active=t.active}))},e.prototype.onDestroy=function(){var t=this;this.colliders.forEach((function(e){return t.physicsManager.removeCollider(e)}))},e}(y),he=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t.allowMultiple=!1,t.physicsManager=t.container.getSingleton("PhysicsManager"),t}return a(i,e),Object.defineProperty(i.prototype,"velocity",{get:function(){return this.rigidBody.velocity},set:function(t){this.rigidBody.velocity.copy(t)},enumerable:!1,configurable:!0}),Object.defineProperty(i.prototype,"gravity",{get:function(){return this.rigidBody.gravity},set:function(t){this.rigidBody.gravity=Math.abs(t)},enumerable:!1,configurable:!0}),i.prototype.init=function(e){var i,s=e.rigidBodyType,n=e.gravity;if(0===this.getColliderIds().length)throw new S("RigidBody needs at least one Collider with physics");this.rigidBody=this.physicsManager.addRigidBody({type:s,colliderIds:this.getColliderIds(),gravity:null!==(i=Math.abs(n))&&void 0!==i?i:0,velocity:new t,position:new t})},i.prototype.update=function(){if(0===this.getColliderIds().length)throw new S("RigidBody needs at least one Collider with physics");this.rigidBody.colliderIds=this.getColliderIds(),this.rigidBody.position=this.gameObject.transform.parent?this.gameObject.transform.innerPosition:this.gameObject.transform.position},i.prototype.getColliderIds=function(){return this.gameObject.getComponents().filter((function(t){return t instanceof ae&&t.physics})).reduce((function(t,e){return l(l([],t,!0),e.colliders.map((function(t){return t.id})),!0)}),[])},i.prototype.onActiveChange=function(){this.rigidBody.active=this.active},i.prototype.onDestroy=function(){this.physicsManager.removeRigidBody(this.rigidBody)},i}(f),le=function(t){function e(e,i,s){void 0===i&&(i="");var n=t.call(this,e)||this;return n.id=d(),n.layer="Default",n.ui=!1,n.keep=!1,n._parent=null,n._active=!0,n.components=[],n.activeComponentsCache=[],n.activeChildrenCache=[],n.name=i,n.addComponent(oe),n.parent=null!=s?s:null,n}return a(e,t),Object.defineProperty(e.prototype,"active",{get:function(){return this._active},set:function(t){this._active!==t&&(this._active=t,this.onActiveChange(),this.updateComponentsActiveStatus(),this.updateChildrenActiveStatus())},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return this._parent},set:function(t){this._parent=t,this.transform.parent=null!==t?t.transform:null},enumerable:!1,configurable:!0}),e.prototype.updateComponentsActiveStatus=function(){var t=this;!1===this.active&&(this.activeComponentsCache=this.components.filter((function(t){return t.active}))),this.activeComponentsCache.forEach((function(e){return e.active=t.active})),!0===this.active&&(this.activeComponentsCache=[])},e.prototype.updateChildrenActiveStatus=function(){var t=this;!1===this.active&&(this.activeChildrenCache=this.getChildren().filter((function(t){return t.active}))),this.activeChildrenCache.forEach((function(e){return e.active=t.active})),!0===this.active&&(this.activeChildrenCache=[])},Object.defineProperty(e.prototype,"transform",{get:function(){return this.getComponent(oe)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rigidBody",{get:function(){return this.getComponent(he)},enumerable:!1,configurable:!0}),e.prototype.onActiveChange=function(){},e.prototype.getCurrentScene=function(){return this.container.getSingleton("SceneManager").getCurrentScene()},e.prototype.addComponent=function(t,e,i){var s="string"==typeof e?void 0:e,n="string"==typeof e?e:i,r=new t(this.container,this,n);return this.checkMultipleComponent(r,t),this.components.push(r),r.dispatch(c.Init,s),r},e.prototype.checkMultipleComponent=function(t,e){if(!1===t.allowMultiple&&this.hasComponent(e))throw new S("GameObject only allows one component of type ".concat(e.name))},e.prototype.getComponents=function(t){return t?this.components.filter((function(e){return e instanceof t})):this.components},e.prototype.getComponent=function(t){return"string"==typeof t?this.components.find((function(e){return e.name===t})):this.components.find((function(e){return e instanceof t}))},e.prototype.hasComponent=function(t){return"string"==typeof t?this.components.some((function(e){return e.name===t})):this.components.some((function(e){return e instanceof t}))},e.prototype.removeComponent=function(t){var e=this.components.indexOf(t);-1!==e&&this.components.splice(e,1)[0].dispatch(c.Destroy)},e.prototype.addChild=function(t,e,i){var s=this.gameObjectManager.addGameObject(t,e,this,i);return s.transform.innerPosition.set(0,0),s.transform.position.copy(this.transform.position),s},e.prototype.getChildren=function(){return this.gameObjectManager.findGameObjectsByParent(this)},e.prototype.getChild=function(t){return this.gameObjectManager.findGameObjectByParent(this,t)},e.prototype.destroyChildren=function(){var t=this;this.gameObjectManager.findGameObjectsByParent(this).forEach((function(e){return t.gameObjectManager.destroyGameObject(e)}))},e.prototype._destroy=function(){var t=this;this.destroyComponents(),Object.keys(this).forEach((function(e){return delete t[e]}))},e.prototype.destroyComponents=function(){for(var t=0;t<this.components.length;t++)this.components[t].dispatch(c.Destroy),delete this.components[t];this.components=[]},e}(g),ce=["Default"],de=function(i){function s(){var t=null!==i&&i.apply(this,arguments)||this;return t.allowMultiple=!1,t.renderManager=t.container.getSingleton("RenderManager"),t.canvas=t.container.getSingleton("DomManager").canvas,t.viewportRect=new e(0,0,0,0),t.worldSpaceRect=new e(0,0,0,0),t.depth=0,t.layers=ce,t._zoom=1,t}return a(s,i),Object.defineProperty(s.prototype,"zoom",{get:function(){return this._zoom},set:function(t){if(this.zoom<=0)throw new S("zoom must be greather than 0");this._zoom=t},enumerable:!1,configurable:!0}),s.prototype.addLayer=function(t){this.layers.push(t)},s.prototype.init=function(){this.cameraData={position:new t,layers:[],depth:1}},s.prototype.update=function(){this.updateViewportRect(),this.updateWorldSpaceRect(),this.updateCameraData()},s.prototype.updateViewportRect=function(){this.viewportRect.x=-this.canvas.width/2,this.viewportRect.y=-this.canvas.height/2,this.viewportRect.width=this.canvas.width,this.viewportRect.height=this.canvas.height},s.prototype.updateWorldSpaceRect=function(){this.worldSpaceRect.x=(this.gameObject.transform.position.x-this.viewportRect.width/2)/this._zoom,this.worldSpaceRect.y=(this.gameObject.transform.position.y-this.viewportRect.height/2)/this._zoom,this.worldSpaceRect.width=this.viewportRect.width/this._zoom,this.worldSpaceRect.height=this.viewportRect.height/this._zoom},s.prototype.updateCameraData=function(){this.cameraData.position.copy(this.gameObject.transform.position),this.cameraData.depth=this.depth,this.cameraData.layers=this.layers,this.cameraData.zoom=this._zoom,this.renderManager.addCameraData(this.cameraData)},s}(M),ue=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return a(e,t),e.prototype.init=function(){this.transform.position.set(0,0),this.camera=this.addComponent(de)},Object.defineProperty(e.prototype,"layers",{get:function(){return this.camera.layers},set:function(t){this.camera.layers=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"depth",{get:function(){return this.camera.depth},set:function(t){this.camera.depth=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"zoom",{get:function(){return this.camera.zoom},set:function(t){this.camera.zoom=t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"worldSpaceRect",{get:function(){return this.camera.worldSpaceRect},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"viewportRect",{get:function(){return this.camera.viewportRect},enumerable:!1,configurable:!0}),e.prototype.addLayer=function(t){this.camera.layers.push(t)},e}(le),pe=function(t){function e(e,i,s){var n=t.call(this,e)||this;return n.name=i,n.game=s,n.game.config.headless||n.addGameObject(ue),n}return a(e,t),Object.defineProperty(e.prototype,"gameCamera",{get:function(){return this.findGameObject(ue)},enumerable:!1,configurable:!0}),e.prototype._destroy=function(){var t=this;this.gameObjectManager.destroyAllGameObjects(),Object.keys(this).forEach((function(e){return delete t[e]}))},e}(g),ge=(function(e){function i(){var i=null!==e&&e.apply(this,arguments)||this;return i.debug=!1,i.offsetX=0,i.offsetY=0,i.scaledVertexModel=[],i.scaledOffset=new t,i.scaledPosition=new t,i.finalRotation=0,i.innerPosition=new t,i}a(i,e),i.prototype.init=function(e){var i,s,n,o,a,h;if(this.container.getConstant("GameConfig").collisions.collisionMethod!==Ut.SAT)throw new S("Polygon Colliders need SAT collision method.");if(e.vertexModel.length<3)throw new S("Polygon Collider needs at least 3 vertices.");this.debug=(null!==(i=e.debug)&&void 0!==i?i:this.debug)&&this.container.getConstant("GameConfig").debugEnabled,this.vertexModel=e.vertexModel,this.offsetX=null!==(s=e.offsetX)&&void 0!==s?s:this.offsetX,this.offsetY=null!==(n=e.offsetY)&&void 0!==n?n:this.offsetY,this.physics=null!==(o=e.physics)&&void 0!==o?o:this.physics,this.rotation=null!==(a=e.rotation)&&void 0!==a?a:new r,this.layer=e.layer;for(var l=0;l<this.vertexModel.length;l++)this.scaledVertexModel.push(new t);this.colliders.push(this.physicsManager.addCollider({layer:null!==(h=this.layer)&&void 0!==h?h:this.gameObject.layer,position:this.gameObject.transform.position.clone(),rotation:this.rotation.radians,shape:new Jt(this.scaledVertexModel),updateCollisions:!0,physics:this.physics,group:this.gameObject.id})),this.debug&&(this.renderer=this.gameObject.addComponent(ge,{collider:this.colliders[0]}))},i.prototype.update=function(){this.updateSize(),this.updatePosition(),this.updateCollider()},i.prototype.updateSize=function(){var t=this;this.vertexModel.forEach((function(e,i){return t.scaledVertexModel[i].set(e.x*t.gameObject.transform.scale.x,e.y*t.gameObject.transform.scale.y)})),this.scaledOffset.x=this.offsetX*this.gameObject.transform.scale.x,this.scaledOffset.y=this.offsetY*this.gameObject.transform.scale.y,this.finalRotation=this.gameObject.transform.rotation.radians+this.rotation.radians},i.prototype.updatePosition=function(){t.add(this.scaledPosition,this.gameObject.transform.position,this.scaledOffset),0!==this.gameObject.transform.rotation.radians&&this.translate()},i.prototype.translate=function(){t.subtract(this.innerPosition,this.scaledPosition,this.gameObject.transform.position);var e=Math.atan2(this.innerPosition.y,this.innerPosition.x)+this.gameObject.transform.rotation.radians;this.scaledPosition.set(this.gameObject.transform.position.x+this.innerPosition.magnitude*Math.cos(e),this.gameObject.transform.position.y+this.innerPosition.magnitude*Math.sin(e))},i.prototype.updateCollider=function(){var t;this.colliders[0].layer=null!==(t=this.layer)&&void 0!==t?t:this.gameObject.layer,this.colliders[0].shape.position=this.scaledPosition,this.colliders[0].rotation=this.finalRotation,this.colliders[0].shape.vertexModel=this.scaledVertexModel}}(ae),function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t.renderManager=t.container.getSingleton("RenderManager"),t}return a(i,e),i.prototype.init=function(e){var i=e.collider;this.renderData={type:P.Geometric,location:j.WorldSpace,layer:this.gameObject.layer,position:new t,shape:C.Polygon,color:"#00FF00"},this.collider=i},i.prototype.update=function(){this.renderData.layer=this.gameObject.layer,this.renderData.position.copy(this.collider.position),this.renderData.rotation=this.collider.shape.rotation,this.renderData.vertexModel=this.collider.shape.vertexModel,this.renderManager.addRenderData(this.renderData)},i}(w)),me=function(e){function i(){var i=null!==e&&e.apply(this,arguments)||this;return i.debug=!1,i.offsetX=0,i.offsetY=0,i.realWidth=0,i.realHeight=0,i.realOffset=new t,i.realPosition=new t,i.realRotation=0,i.applyRotation=i.container.getConstant("GameConfig").collisions.collisionMethod===Ut.SAT,i.innerPosition=new t,i}return a(i,e),i.prototype.init=function(t){var e,i,s,n,o,a;this.width=t.width,this.height=t.height,this.offsetX=null!==(e=t.offsetX)&&void 0!==e?e:this.offsetX,this.offsetY=null!==(i=t.offsetY)&&void 0!==i?i:this.offsetY,this.physics=null!==(s=t.physics)&&void 0!==s?s:this.physics,this.debug=(null!==(n=t.debug)&&void 0!==n?n:this.debug)&&this.container.getConstant("GameConfig").debugEnabled,this.rotation=null!==(o=t.rotation)&&void 0!==o?o:new r,this.layer=t.layer,this.colliders.push(this.physicsManager.addCollider({layer:null!==(a=this.layer)&&void 0!==a?a:this.gameObject.layer,position:this.gameObject.transform.position.clone(),rotation:this.rotation.radians,shape:new Zt(this.realWidth,this.realHeight),updateCollisions:!0,physics:this.physics,group:this.gameObject.id})),this.debug&&(this.renderer=this.gameObject.addComponent(ge,{collider:this.colliders[0]}))},i.prototype.update=function(){this.updateRealSize(),this.updatePosition(),this.updateCollider()},i.prototype.updateRealSize=function(){this.realWidth=this.width*Math.abs(this.gameObject.transform.scale.x),this.realHeight=this.height*Math.abs(this.gameObject.transform.scale.y),this.realOffset.x=this.offsetX*this.gameObject.transform.scale.x,this.realOffset.y=this.offsetY*this.gameObject.transform.scale.y,this.realRotation=this.applyRotation?this.gameObject.transform.rotation.radians+this.rotation.radians:0},i.prototype.updatePosition=function(){t.add(this.realPosition,this.gameObject.transform.position,this.realOffset),0!==this.gameObject.transform.rotation.radians&&this.translate()},i.prototype.translate=function(){t.subtract(this.innerPosition,this.realPosition,this.gameObject.transform.position);var e=Math.atan2(this.innerPosition.y,this.innerPosition.x)+this.gameObject.transform.rotation.radians;this.realPosition.set(this.gameObject.transform.position.x+this.innerPosition.magnitude*Math.cos(e),this.gameObject.transform.position.y+this.innerPosition.magnitude*Math.sin(e))},i.prototype.updateCollider=function(){var t;this.colliders[0].layer=null!==(t=this.layer)&&void 0!==t?t:this.gameObject.layer,this.colliders[0].position=this.realPosition,this.colliders[0].rotation=this.realRotation,this.colliders[0].shape.updateSize(this.realWidth,this.realHeight)},i}(ae),fe=(function(e){function i(){var i=null!==e&&e.apply(this,arguments)||this;return i.debug=!1,i.offsetX=0,i.offsetY=0,i.realRadius=0,i.realOffset=new t,i.realPosition=new t,i.innerPosition=new t,i}a(i,e),i.prototype.init=function(t){var e,i,s,n,r;this.radius=t.radius,this.offsetX=null!==(e=t.offsetX)&&void 0!==e?e:this.offsetX,this.offsetY=null!==(i=t.offsetY)&&void 0!==i?i:this.offsetY,this.physics=null!==(s=t.physics)&&void 0!==s?s:this.physics,this.debug=(null!==(n=t.debug)&&void 0!==n?n:this.debug)&&this.container.getConstant("GameConfig").debugEnabled,this.layer=t.layer,this.colliders.push(this.physicsManager.addCollider({layer:null!==(r=this.layer)&&void 0!==r?r:this.gameObject.layer,position:this.gameObject.transform.position.clone(),shape:new $t(this.radius),updateCollisions:!0,physics:this.physics,group:this.gameObject.id})),this.debug&&(this.renderer=this.gameObject.addComponent(fe,{collider:this.colliders[0]}))},i.prototype.update=function(){this.updateRealSize(),this.updatePosition(),this.updateCollider()},i.prototype.updateRealSize=function(){this.realRadius=this.radius*Math.max(Math.abs(this.gameObject.transform.scale.x),Math.abs(this.gameObject.transform.scale.y)),this.realOffset.x=this.offsetX*this.gameObject.transform.scale.x,this.realOffset.y=this.offsetY*this.gameObject.transform.scale.y},i.prototype.updatePosition=function(){t.add(this.realPosition,this.gameObject.transform.position,this.realOffset),0!==this.gameObject.transform.rotation.radians&&this.translate()},i.prototype.translate=function(){t.subtract(this.innerPosition,this.realPosition,this.gameObject.transform.position);var e=Math.atan2(this.innerPosition.y,this.innerPosition.x)+this.gameObject.transform.rotation.radians;this.realPosition.set(this.gameObject.transform.position.x+this.innerPosition.magnitude*Math.cos(e),this.gameObject.transform.position.y+this.innerPosition.magnitude*Math.sin(e))},i.prototype.updateCollider=function(){var t;this.colliders[0].layer=null!==(t=this.layer)&&void 0!==t?t:this.gameObject.layer,this.colliders[0].position=this.realPosition,this.colliders[0].shape.radius=this.realRadius}}(ae),function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t.renderManager=t.container.getSingleton("RenderManager"),t}return a(i,e),i.prototype.init=function(e){var i=e.collider;this.renderData={type:P.Geometric,location:j.WorldSpace,layer:this.gameObject.layer,position:new t,shape:C.Circumference,color:"#00FF00"},this.collider=i},i.prototype.update=function(){this.renderData.layer=this.gameObject.layer,this.renderData.position.copy(this.collider.position),this.renderData.radius=this.collider.shape.radius,this.renderManager.addRenderData(this.renderData)},i}(w)),ye=function(e){function i(){var i=null!==e&&e.apply(this,arguments)||this;return i.debug=!1,i.position=new t,i}return a(i,e),i.prototype.init=function(t){var e,i;this.tilemapRenderer=t.tilemapRenderer,this.layer=t.layer,this.debug=(null!==(e=t.debug)&&void 0!==e?e:this.debug)&&this.container.getConstant("GameConfig").debugEnabled,this.physics=!0,this.composite=null!==(i=t.composite)&&void 0!==i&&i,this.scaledTileWidth=this.tilemapRenderer.tileWidth*this.gameObject.transform.scale.x,this.scaledTileHeight=this.tilemapRenderer.tileHeight*this.gameObject.transform.scale.y,this.scaledWidth=this.tilemapRenderer.width*this.scaledTileWidth,this.scaledHeight=this.tilemapRenderer.height*this.scaledTileHeight,this.position.set(this.gameObject.transform.position.x+(this.tilemapRenderer.orientation===_.Center?-this.scaledWidth/2:0),this.gameObject.transform.position.y+([_.Center,_.RightCenter].includes(this.tilemapRenderer.orientation)?this.scaledHeight/2:this.tilemapRenderer.orientation==_.RightUp?this.scaledHeight:0)),this.composite?this.useLineColliders():this.useBoxColliders(),this.debug&&(this.renderer=this.gameObject.addComponent(xe,{colliders:this.colliders}))},i.prototype.useBoxColliders=function(){var e=this;this.tilemapRenderer.tiles.forEach((function(i,s){var n;e.needsCollider(i,s)&&e.colliders.push(e.physicsManager.addCollider({layer:null!==(n=e.layer)&&void 0!==n?n:e.gameObject.layer,position:new t(e.position.x+(s%e.tilemapRenderer.width+.5)*e.scaledTileWidth,e.position.y-(Math.floor(s/e.tilemapRenderer.width)+.5)*e.scaledTileHeight),shape:new Zt(e.scaledTileWidth,e.scaledTileHeight),updateCollisions:!1,physics:e.physics,group:e.gameObject.id}))}))},i.prototype.useLineColliders=function(){var e,i,s=this,n=[],r=[];this.tilemapRenderer.tiles.forEach((function(t,e){if(0!==t){var i=e%s.tilemapRenderer.width,o=Math.floor(e/s.tilemapRenderer.width);n[o]||(n[o]=[]),n[o+1]||(n[o+1]=[]),r[o]||(r[o]=[]),r[o+1]||(r[o+1]=[]);var a=s.getNeighbors(e);s.hasTile(a[0])||(n[o][i]=!0,n[o][i+1]=!0),s.hasTile(a[2])||(n[o+1][i]=!0,n[o+1][i+1]=!0),s.hasTile(a[1])||(r[o][i]=!0,r[o+1][i]=!0),s.hasTile(a[3])||(r[o][i+1]=!0,r[o+1][i+1]=!0)}}));for(var o=0;o<n.length;o++)for(var a=0;a<n[o].length;a++)!e||!i||o*-this.scaledTileHeight===i.y&&n[o][a]||(this.addLineCollider(e,i),e=void 0,i=void 0),n[o][a]&&(e?i=new t(a*this.scaledTileWidth,o*-this.scaledTileHeight):e=new t(a*this.scaledTileWidth,o*-this.scaledTileHeight));for(e&&i&&this.addLineCollider(e,i),e=void 0,i=void 0,a=0;a<=this.tilemapRenderer.width;a++)for(o=0;o<r.length;o++)!e||!i||a*this.scaledTileWidth===i.x&&r[o][a]||(this.addLineCollider(e,i),e=void 0,i=void 0),r[o][a]&&(e?i=new t(a*this.scaledTileWidth,o*-this.scaledTileHeight):e=new t(a*this.scaledTileWidth,o*-this.scaledTileHeight));e&&i&&this.addLineCollider(e,i)},i.prototype.hasTile=function(t){return void 0!==t&&this.tilemapRenderer.tiles[t]&&this.tilemapRenderer.tiles[t]>0},i.prototype.addLineCollider=function(t,e){var i,s=this.physicsManager.addCollider({layer:null!==(i=this.layer)&&void 0!==i?i:this.gameObject.layer,position:this.position.clone(),shape:new Qt([t.clone(),e.clone()]),updateCollisions:!0,physics:this.physics,group:this.gameObject.id});this.colliders.push(s)},i.prototype.needsCollider=function(t,e){var i=this;return 0!==t&&this.getNeighbors(e).some((function(t){return!t||!i.tilemapRenderer.tiles[t]||0===i.tilemapRenderer.tiles[t]}))},i.prototype.getNeighbors=function(t){return[t-this.tilemapRenderer.width>=0?t-this.tilemapRenderer.width:void 0,t%this.tilemapRenderer.width>0?t-1:void 0,t+this.tilemapRenderer.width<=this.tilemapRenderer.width*this.tilemapRenderer.height?t+this.tilemapRenderer.width:void 0,t%this.tilemapRenderer.width<this.tilemapRenderer.width-1?t+1:void 0]},i.prototype.update=function(){var t=this;this.colliders.forEach((function(e){var i;return e.layer=null!==(i=t.layer)&&void 0!==i?i:t.gameObject.layer}))},i}(ae),xe=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t.renderManager=t.container.getSingleton("RenderManager"),t.renderData=[],t.colliders=[],t}return a(i,e),i.prototype.init=function(e){var i=this,s=e.colliders;this.colliders=s,this.colliders.forEach((function(e,s){i.renderData[s]={type:P.Geometric,layer:i.gameObject.layer,location:j.WorldSpace,position:new t,shape:C.Polygon,color:"#00FF00"}}))},i.prototype.update=function(){var t=this;this.colliders.forEach((function(e,i){t.renderData[i].layer=t.gameObject.layer,t.renderData[i].position.copy(e.shape.position),t.renderData[i].rotation=e.rotation,t.renderData[i].vertexModel=e.shape.vertexModel,t.renderManager.addRenderData(t.renderData[i])}))},i}(w),ve=(function(e){function i(){var i=null!==e&&e.apply(this,arguments)||this;return i.debug=!1,i.offsetX=0,i.offsetY=0,i.scaledVertexModel=[],i.scaledOffset=new t,i.scaledPosition=new t,i.finalRotation=0,i.innerPosition=new t,i}a(i,e),i.prototype.init=function(e){var i,s,n,o,a,h;if(this.container.getConstant("GameConfig").collisions.collisionMethod!==Ut.SAT)throw new S("Edge Colliders need SAT collision method.");if(e.vertexModel.length<2)throw new S("Edge Collider needs at least 2 vertices.");this.debug=(null!==(i=e.debug)&&void 0!==i?i:this.debug)&&this.container.getConstant("GameConfig").debugEnabled,this.vertexModel=e.vertexModel,this.offsetX=null!==(s=e.offsetX)&&void 0!==s?s:this.offsetX,this.offsetY=null!==(n=e.offsetY)&&void 0!==n?n:this.offsetY,this.physics=null!==(o=e.physics)&&void 0!==o?o:this.physics,this.rotation=null!==(a=e.rotation)&&void 0!==a?a:new r,this.layer=e.layer;for(var l=0;l<this.vertexModel.length;l++)this.scaledVertexModel.push(new t);for(l=0;l<this.scaledVertexModel.length-1;l++)this.colliders.push(this.physicsManager.addCollider({layer:null!==(h=this.layer)&&void 0!==h?h:this.gameObject.layer,position:this.gameObject.transform.position.clone(),rotation:this.rotation.radians,shape:new Qt([this.scaledVertexModel[l],this.scaledVertexModel[l+1]]),updateCollisions:!0,physics:this.physics,group:this.gameObject.id}));this.debug&&(this.renderer=this.gameObject.addComponent(ve,{colliders:this.colliders}))},i.prototype.update=function(){this.updateSize(),this.updatePosition(),this.updateColliders()},i.prototype.updateSize=function(){var t=this;this.vertexModel.forEach((function(e,i){return t.scaledVertexModel[i].set(e.x*t.gameObject.transform.scale.x,e.y*t.gameObject.transform.scale.y)})),this.scaledOffset.x=this.offsetX*this.gameObject.transform.scale.x,this.scaledOffset.y=this.offsetY*this.gameObject.transform.scale.y,this.finalRotation=this.gameObject.transform.rotation.radians+this.rotation.radians},i.prototype.updatePosition=function(){t.add(this.scaledPosition,this.gameObject.transform.position,this.scaledOffset),0!==this.gameObject.transform.rotation.radians&&this.translate()},i.prototype.translate=function(){t.subtract(this.innerPosition,this.scaledPosition,this.gameObject.transform.position);var e=Math.atan2(this.innerPosition.y,this.innerPosition.x)+this.gameObject.transform.rotation.radians;this.scaledPosition.set(this.gameObject.transform.position.x+this.innerPosition.magnitude*Math.cos(e),this.gameObject.transform.position.y+this.innerPosition.magnitude*Math.sin(e))},i.prototype.updateColliders=function(){for(var t,e=0;e<this.scaledVertexModel.length-1;e++)this.colliders[e].layer=null!==(t=this.layer)&&void 0!==t?t:this.gameObject.layer,this.colliders[e].position=this.scaledPosition,this.colliders[e].rotation=this.finalRotation,this.colliders[e].shape.vertexModel=[this.scaledVertexModel[e],this.scaledVertexModel[e+1]]}}(ae),function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t.renderManager=t.container.getSingleton("RenderManager"),t.renderData=[],t.colliders=[],t}return a(i,e),i.prototype.init=function(e){var i=this,s=e.colliders;this.colliders=s,this.colliders.forEach((function(e,s){i.renderData[s]={type:P.Geometric,layer:i.gameObject.layer,location:j.WorldSpace,position:new t,shape:C.Line,color:"#00FF00"}}))},i.prototype.update=function(){var t=this;this.colliders.forEach((function(e,i){t.renderData[i].layer=t.gameObject.layer,t.renderData[i].position=e.position,t.renderData[i].rotation=e.rotation,t.renderData[i].vertexModel=e.shape.vertexModel,t.renderManager.addRenderData(t.renderData[i])}))},i}(w)),be=function(e){function i(){var i=null!==e&&e.apply(this,arguments)||this;return i.renderManager=i.container.getSingleton("RenderManager"),i.spriteDefaultScale=i.container.getConstant("GameConfig").spriteDefaultScale,i.renderData=[],i.innerPosition=new t,i.cachePosition=new t,i.cacheRenderPosition=new t,i.scaledOffset=new t,i}return a(i,e),i.prototype.init=function(e){var i,s,n,o,a,h,l;void 0===e&&(e={}),this.sprite=e.sprite,this.offset=null!==(i=e.offset)&&void 0!==i?i:new t,this.rotation=null!==(s=e.rotation)&&void 0!==s?s:new r,this.flipHorizontal=null!==(n=e.flipHorizontal)&&void 0!==n&&n,this.flipVertical=null!==(o=e.flipVertical)&&void 0!==o&&o,this.opacity=null!==(a=e.opacity)&&void 0!==a?a:1,this._tiled=null!==(h=e.tiled)&&void 0!==h?h:new t(1,1),this.maskColor=e.maskColor,this.maskColorMix=null!==(l=e.maskColorMix)&&void 0!==l?l:0,this.tintColor=e.tintColor,this.layer=e.layer},Object.defineProperty(i.prototype,"tiled",{get:function(){return this._tiled},set:function(t){if(t.x%1!=0||t.y%1!=0)throw new S("SpriteRenderer.tiled: Vector2 components must be integers");this._tiled.set(t.x,t.y)},enumerable:!1,configurable:!0}),i.prototype.update=function(){var t;if(this.sprite&&!0===this.sprite.loaded){this.sprite.scale=null!==(t=this.sprite.scale)&&void 0!==t?t:this.spriteDefaultScale,this.updateRenderDataArray();for(var e=0,i=0;i<this._tiled.x;i++)for(var s=0;s<this._tiled.y;s++)this.updateRenderData(e,i,s),e++}},i.prototype.updateRenderDataArray=function(){if(this.renderData.length!==this._tiled.x*this._tiled.y){this.renderData=[];for(var e=0;e<this._tiled.x*this._tiled.y;e++)this.renderData[e]={type:P.Sprite,location:j.WorldSpace,layer:"",position:new t,image:this.sprite.image,width:0,height:0}}},i.prototype.updateRenderData=function(t,e,i){var s;this.renderData[t].location=this.gameObject.ui?j.ViewPort:j.WorldSpace,this.renderData[t].layer=null!==(s=this.layer)&&void 0!==s?s:this.gameObject.layer,this.renderData[t].image=this.sprite.image,this.renderData[t].width=this.sprite.width*Math.abs(this.gameObject.transform.scale.x),this.renderData[t].height=this.sprite.height*Math.abs(this.gameObject.transform.scale.y),this.renderData[t].slice=this.sprite.slice,this.renderData[t].flipHorizontal=this.flipHorizontal!==this.gameObject.transform.scale.x<0,this.renderData[t].flipVertical=this.flipVertical!==this.gameObject.transform.scale.y<0,this.renderData[t].rotation=this.gameObject.transform.rotation.radians+this.rotation.radians,this.renderData[t].smooth=this.sprite.smooth,this.renderData[t].alpha=this.opacity,this.renderData[t].maskColor=this.maskColor,this.renderData[t].maskColorMix=this.maskColorMix,this.renderData[t].tintColor=this.tintColor,this.calculateRenderPosition(t,e,i),this.renderManager.addRenderData(this.renderData[t])},i.prototype.calculateRenderPosition=function(e,i,s){this.scaledOffset.set(this.offset.x*this.gameObject.transform.scale.x,this.offset.y*this.gameObject.transform.scale.y),t.add(this.cachePosition,this.gameObject.transform.position,this.scaledOffset),this.cacheRenderPosition.set(this.renderData[e].width/2*(this._tiled.x-1),this.renderData[e].height/2*(this._tiled.y-1)),t.subtract(this.cachePosition,this.cachePosition,this.cacheRenderPosition),this.cacheRenderPosition.set(i*this.renderData[e].width,s*this.renderData[e].height),t.add(this.renderData[e].position,this.cachePosition,this.cacheRenderPosition),0!==this.gameObject.transform.rotation.radians&&this.translateRenderPosition(e)},i.prototype.translateRenderPosition=function(e){t.subtract(this.innerPosition,this.renderData[e].position,this.gameObject.transform.position);var i=Math.atan2(this.innerPosition.y,this.innerPosition.x)+this.gameObject.transform.rotation.radians;this.renderData[e].position.set(this.gameObject.transform.position.x+this.innerPosition.magnitude*Math.cos(i),this.gameObject.transform.position.y+this.innerPosition.magnitude*Math.sin(i))},i}(w),Me=function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t.renderManager=t.container.getSingleton("RenderManager"),t.lastFrameText="",t}return a(i,e),i.prototype.init=function(e){var i,s,n,o,a,h,l,c,d,u;if(this.text=e.text,this.font=null!==(i=e.font)&&void 0!==i?i:"Sans",this.fontSize=null!==(s=e.fontSize)&&void 0!==s?s:12,this.width=null!==(n=e.width)&&void 0!==n?n:100,this.height=null!==(o=e.height)&&void 0!==o?o:100,this.offset=null!==(a=e.offset)&&void 0!==a?a:new t,this.color=null!==(h=e.color)&&void 0!==h?h:"#000000",this.charRanges=null!==(l=e.charRanges)&&void 0!==l?l:[32,126,161,255],this.lineSeparation=null!==(c=e.lineSeparation)&&void 0!==c?c:0,this.letterSpacing=null!==(d=e.letterSpacing)&&void 0!==d?d:0,this.smooth=e.smooth,this.rotation=null!==(u=e.rotation)&&void 0!==u?u:new r,this.opacity=e.opacity,this.orientation=e.orientation,this.bitmapMargin=e.bitmapMargin,this.bitmapSpacing=e.bitmapSpacing,this.charRanges.length%2!=0)throw new S("TextRenderer.charRanges must be a 2 column matrix");if(this.lineSeparation%2!=0)throw new S("TextRenderer.lineSeparation must be multiple of 2")},i.prototype.start=function(){this.renderData={type:P.Text,location:j.WorldSpace,position:new t,layer:this.gameObject.layer,text:"",font:this.font,fontSize:this.fontSize,bitmap:{charRanges:this.charRanges,margin:this.bitmapMargin,spacing:this.bitmapSpacing},smooth:this.smooth}},i.prototype.update=function(){var e,i;this.text&&(this.renderData.layer=this.gameObject.layer,this.renderData.location=this.gameObject.ui?j.ViewPort:j.WorldSpace,this.renderData.text=this.text!==this.lastFrameText?this.crop():this.renderData.text,this.renderData.fontSize=this.fontSize,this.renderData.color=this.color,this.renderData.orientation=this.orientation,this.renderData.lineSeparation=this.lineSeparation,this.renderData.letterSpacing=this.letterSpacing,this.renderData.rotation=null!==(i=this.gameObject.transform.rotation.radians+(null===(e=this.rotation)||void 0===e?void 0:e.radians))&&void 0!==i?i:0,this.renderData.alpha=this.opacity,t.add(this.renderData.position,this.gameObject.transform.position,this.offset),this.renderManager.addRenderData(this.renderData),this.lastFrameText=this.text)},i.prototype.crop=function(){var t;if(this.fontSize>this.height)return"";for(var e=[],i=0,s=0,n=this.text.split("\n");s<n.length;s++)for(var r=0,o=null!==(t=n[s].match(new RegExp(".{1,"+Math.floor(this.width/(this.fontSize+this.letterSpacing))+"}","g")))&&void 0!==t?t:[""];r<o.length;r++){var a=o[r];if((i+=this.fontSize+this.lineSeparation)>this.height)return e.join("\n");e.push(a)}return e.join("\n")},i}(w),we=(function(e){function i(){var i=null!==e&&e.apply(this,arguments)||this;return i.renderManager=i.container.getSingleton("RenderManager"),i.offset=new t,i.rotation=new r,i.opacity=1,i.innerPosition=new t,i.scaledOffset=new t,i}a(i,e),i.prototype.init=function(e){var i,s,n,r;this.width=e.width,this.height=e.height,this.color=e.color,this.offset=null!==(i=e.offset)&&void 0!==i?i:this.offset,this.rotation=null!==(s=e.rotation)&&void 0!==s?s:this.rotation,this.opacity=null!==(n=e.opacity)&&void 0!==n?n:this.opacity,this.layer=e.layer,this.renderData={type:P.Mask,layer:null!==(r=this.layer)&&void 0!==r?r:this.gameObject.layer,location:this.gameObject.ui?j.ViewPort:j.WorldSpace,position:new t,width:0,height:0,color:""}},i.prototype.update=function(){var t;this.renderData.location=this.gameObject.ui?j.ViewPort:j.WorldSpace,this.renderData.layer=null!==(t=this.layer)&&void 0!==t?t:this.gameObject.layer,this.renderData.width=this.width*Math.abs(this.gameObject.transform.scale.x),this.renderData.height=this.height*Math.abs(this.gameObject.transform.scale.y),this.renderData.color=this.color,this.renderData.rotation=this.gameObject.transform.rotation.radians+this.rotation.radians,this.renderData.alpha=this.opacity,this.calculateRenderPosition(),this.renderManager.addRenderData(this.renderData)},i.prototype.calculateRenderPosition=function(){this.scaledOffset.set(this.offset.x*this.gameObject.transform.scale.x,this.offset.y*this.gameObject.transform.scale.y),t.add(this.renderData.position,this.gameObject.transform.position,this.scaledOffset),0!==this.gameObject.transform.rotation.radians&&this.translateRenderPosition()},i.prototype.translateRenderPosition=function(){t.subtract(this.innerPosition,this.renderData.position,this.gameObject.transform.position);var e=Math.atan2(this.innerPosition.y,this.innerPosition.x)+this.gameObject.transform.rotation.radians;this.renderData.position.set(this.gameObject.transform.position.x+this.innerPosition.magnitude*Math.cos(e),this.gameObject.transform.position.y+this.innerPosition.magnitude*Math.sin(e))}}(w),function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t.renderManager=t.container.getSingleton("RenderManager"),t.tiles=[],t.tilesetTileIds=[],t.chunks=[],t.scaledTileWidth=0,t.scaledTileHeight=0,t.renderData=[],t}return a(i,e),i.prototype.init=function(t){var e=t.tiledData,i=t.tilemapLayer,s=t.tileset,n=t.tileWidth,r=t.tileHeight,o=t.layer,a=t.orientation,h=t.smooth;this.tiledData=e,this.tilemapLayer=i,this.tileset=s,this.tileWidth=n,this.tileHeight=r,this.layer=o,this.smooth=null!=h&&h,this.width=this.tiledData.width,this.height=this.tiledData.height,this.orientation=a,this.processTilemap()},i.prototype.update=function(){var t=this;this.updateRenderData(),this.renderData.forEach((function(e){return t.renderManager.addRenderData(e)}))},i.prototype.processTilemap=function(){var t=this;this.tiledData.layers.forEach((function(e){!0===e.visible&&t.tilemapLayer===e.name&&(t.alpha=e.opacity,t.tintColor=e.tintcolor,!0===t.tiledData.infinite?e.chunks.forEach((function(i){return t.processChunk(i,e)})):t.processChunk(e,e))})),this.updateRenderData(),this.tilesetTileIds=[]},i.prototype.processChunk=function(e,i){var s,n=this,r={type:P.Tilemap,layer:null!==(s=this.layer)&&void 0!==s?s:this.gameObject.layer,location:this.gameObject.ui?j.ViewPort:j.WorldSpace,position:new t,tileset:this.tileset,tilemap:{width:e.width,tileWidth:this.tileWidth,tileHeight:this.tileHeight},tiles:e.data.map((function(t){return n.getTilesetTileId(t)})),orientation:this.orientation,smooth:this.smooth};e.type&&"tilelayer"===e.type?this.tiles=r.tiles:r.tiles.forEach((function(t,i){n.tiles[n.tiledData.width*(e.y+Math.floor(i/e.width))+e.x+i%e.width]=t})),this.renderData.push(r),this.chunks.push(e)},i.prototype.getTilesetTileId=function(t){return this.tilesetTileIds[t]||(this.tilesetTileIds[t]=this.tiledData.tilesets.reduce((function(e,i){return t>=i.firstgid?t-i.firstgid+1:e}),0)),this.tilesetTileIds[t]},i.prototype.updateRenderData=function(){var t=this;this.scaledTileWidth=this.tileWidth*this.gameObject.transform.scale.x,this.scaledTileHeight=this.tileHeight*this.gameObject.transform.scale.y,this.realWidth=this.tiledData.width*this.scaledTileWidth,this.realHeight=this.tiledData.height*this.scaledTileHeight,this.renderData.forEach((function(e,i){var s;e.layer=null!==(s=t.layer)&&void 0!==s?s:t.gameObject.layer,e.position.set(t.gameObject.transform.position.x+t.chunks[i].x*t.scaledTileWidth,t.gameObject.transform.position.y+t.chunks[i].y*t.scaledTileHeight),e.tilemap.tileWidth=t.scaledTileWidth,e.tilemap.tileHeight=t.scaledTileHeight,e.tintColor=t.tintColor,e.alpha=t.alpha}))},i}(w)),Ce=(function(e){function i(){var t=null!==e&&e.apply(this,arguments)||this;return t.renderManager=t.container.getSingleton("RenderManager"),t.tiles=[],t.scaledTileWidth=0,t.scaledTileHeight=0,t}a(i,e),i.prototype.init=function(e){var i,s=this,n=e.tiles,r=e.tileset,o=e.tileWidth,a=e.tileHeight,h=e.width,l=e.layer,c=e.orientation,d=e.alpha,u=e.tintColor,p=e.smooth;n.split("\n").forEach((function(t){t.split(",").forEach((function(t){return t.trim().length>0?s.tiles.push(Number(t)):null}))})),this.tileset=r,this.width=h,this.tileWidth=o,this.tileHeight=a,this.layer=l,this.height=Math.ceil(this.tiles.length/this.width),this.orientation=c,this.alpha=d,this.tintColor=u,this.renderData={type:P.Tilemap,layer:null!==(i=this.layer)&&void 0!==i?i:this.gameObject.layer,location:this.gameObject.ui?j.ViewPort:j.WorldSpace,position:new t,tileset:this.tileset,tilemap:{width:this.width,tileWidth:this.tileWidth,tileHeight:this.tileHeight},tiles:this.tiles,orientation:this.orientation,smooth:p},this.updateRenderData()},i.prototype.update=function(){this.updateRenderData(),this.renderManager.addRenderData(this.renderData)},i.prototype.updateRenderData=function(){var t;this.scaledTileWidth=this.tileWidth*this.gameObject.transform.scale.x,this.scaledTileHeight=this.tileHeight*this.gameObject.transform.scale.y,this.realWidth=this.width*this.scaledTileWidth,this.realHeight=this.height*this.scaledTileHeight,this.renderData.layer=null!==(t=this.layer)&&void 0!==t?t:this.gameObject.layer,this.renderData.position.copy(this.gameObject.transform.position),this.renderData.tintColor=this.tintColor,this.renderData.alpha=this.alpha,this.renderData.tilemap.tileWidth=this.scaledTileWidth,this.renderData.tilemap.tileHeight=this.scaledTileHeight}}(w),function(t){var e,i;this.sprites=[],this.framerate=10,this.loop=!1,this.sprites=t.sprites,this.framerate=null!==(e=t.framerate)&&void 0!==e?e:this.framerate,this.loop=null!==(i=t.loop)&&void 0!==i?i:this.loop}),je=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.timeManager=e.container.getSingleton("TimeManager"),e.spriteRenderer=null,e.animations=new Map,e.currentAnimation=null,e.paused=!1,e}return a(e,t),e.prototype.init=function(t){var e=t.spriteRenderer;this.spriteRenderer=e},e.prototype.update=function(){null===this.currentAnimation||this.paused||(this.currentAnimation.playFrame(this.timeManager.deltaTime),!0===this.currentAnimation.restarted&&!1===this.currentAnimation.loop?this.currentAnimation=null:this.spriteRenderer.sprite=this.currentAnimation.sprite)},e.prototype.addAnimation=function(t,e,i){return void 0===e&&(e="default"),t.framerate=null!=i?i:t.framerate,this.animations.set(e,new Pe(t)),this},e.prototype.playAnimation=function(t){if(void 0===t&&(t="default"),!1!==this.active){if(!1===this.animations.has(t))throw new S("Animation with name ".concat(t," does not exist."));this.stopAnimation(),this.currentAnimation=this.animations.get(t)}},e.prototype.pause=function(){this.paused=!0},e.prototype.resume=function(){this.paused=!1},e.prototype.stopAnimation=function(){null!==this.currentAnimation&&(this.currentAnimation.reset(),this.currentAnimation=null)},e.prototype.isPlayingAnimation=function(t){return this.animations.get(t)&&this.animations.get(t)===this.currentAnimation},e}(f),Pe=function(){function t(t){this._sprite=null,this._restarted=!1,this.currentFrame=0,this.frameTime=0,this._animation=t}return Object.defineProperty(t.prototype,"sprite",{get:function(){return this._sprite},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"restarted",{get:function(){return this._restarted},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"loop",{get:function(){return this._animation.loop},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"animation",{get:function(){return this._animation},enumerable:!1,configurable:!0}),t.prototype.reset=function(){this.currentFrame=0,this.frameTime=0,this._restarted=!0},t.prototype.playFrame=function(t){this._restarted=!1,this.frameTime>=1/this._animation.framerate&&(this.frameTime=0,this.currentFrame=this.currentFrame+1===this._animation.sprites.length?0:this.currentFrame+1,this._restarted=0===this.currentFrame),this._sprite=this._animation.sprites[this.currentFrame],this.frameTime+=t},t}(),_e=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","pointerup","touchend","keydown","keyup"],Oe=(function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.allowMultiple=!1,e.volume=1,e.loop=!1,e.audio=null,e.clones=new Map,e._playing=!1,e._paused=!1,e.audioEventHandler=function(t){"ended"===t.type&&(e._playing=!1,e.audio.removeEventListener("ended",e.audioEventHandler))},e.userinputEventHandler=function(){_e.forEach((function(t){window.removeEventListener(t,e.userinputEventHandler)})),e.audio.play()},e}a(e,t),e.prototype.init=function(t){var e,i,s;void 0===t&&(t={}),this.audio=null!==(e=t.audio)&&void 0!==e?e:this.audio,this.volume=null!==(i=t.volume)&&void 0!==i?i:this.volume,this.loop=null!==(s=t.loop)&&void 0!==s?s:this.loop},e.prototype.playAudio=function(t,e){void 0===e&&(e=null),!1===this.clones.has(Symbol.for(t.src))&&this.cloneAudio(t);var i=this.clones.get(Symbol.for(t.src));i.currentTime>0&&(i.currentTime=0),i.volume=null!=e?e:this.volume,i.play()},e.prototype.cloneAudio=function(t){var e=t.cloneNode();this.clones.set(Symbol.for(t.src),e)},e.prototype.play=function(){var t=this;if(null!==this.audio&&(!this._playing||!1!==this._paused)){if(this._paused)return this._paused=!1,void this.audio.play();this.audio.volume=this.volume,this.audio.loop=this.loop,this.audio.addEventListener("ended",this.audioEventHandler),this._playing=!0,this.audio.play().then((function(){})).catch((function(){return _e.forEach((function(e){return window.addEventListener(e,t.userinputEventHandler)}))}))}},e.prototype.stop=function(){this._playing&&(this.audio.pause(),this.audio.currentTime=0,this.audio.removeEventListener("ended",this.audioEventHandler),this._playing=!1,this._paused=!1)},e.prototype.pause=function(){this._playing&&!1===this._paused&&(this.audio.pause(),this._paused=!0)},e.prototype.onActiveChange=function(){!1===this.active&&this.stop()},e.prototype.onDestroy=function(){this.stop()}}(f),function(){function t(t){var e,i=this;this._width=null,this._height=null,this._loaded=!1,this.image=t.image,this.smooth=null!==(e=t.smooth)&&void 0!==e&&e,this.slice=t.slice,this.scale=t.scale,this.slice&&(this._width=this.slice.width,this._height=this.slice.height);var s=function(){var t,e;i._width=null!==(t=i._width)&&void 0!==t?t:i.image.naturalWidth,i._height=null!==(e=i._height)&&void 0!==e?e:i.image.naturalHeight,i._loaded=!0};this.image.naturalWidth?s():this.image.addEventListener("load",(function(){return s()}))}return Object.defineProperty(t.prototype,"width",{get:function(){var t,e;return null!==(e=this._width*(null===(t=this.scale)||void 0===t?void 0:t.x))&&void 0!==e?e:1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){var t,e;return null!==(e=this._height*(null===(t=this.scale)||void 0===t?void 0:t.y))&&void 0!==e?e:1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"loaded",{get:function(){return this._loaded},enumerable:!1,configurable:!0}),t}());!function(t){t[t.Rectangle=0]="Rectangle",t[t.Circumference=1]="Circumference"}(te||(te={}));!function(e){function i(){var i=null!==e&&e.apply(this,arguments)||this;return i.allowMultiple=!1,i.width=100,i.height=100,i.radius=50,i.touchEnabled=!0,i._offset=new t,i.pressed=!1,i.mouse=i.container.getSingleton("InputManager").mouse,i.touch=i.container.getSingleton("InputManager").touch,i.position=new t,i.distance=new t,i.pressedLastFrame=!1,i.scaled={width:0,height:0,radius:0,offset:new t},i}a(i,e),Object.defineProperty(i.prototype,"offset",{get:function(){return this._offset},set:function(t){this._offset=t},enumerable:!1,configurable:!0}),i.prototype.init=function(t){var e=t.type,i=t.height,s=t.radius,n=t.touchEnabled,r=t.width,o=t.offset;this.type=e,this.width=null!=r?r:this.width,this.height=null!=i?i:this.height,this.radius=null!=s?s:this.radius,this.touchEnabled=null!=n?n:this.touchEnabled,this._offset=null!=o?o:this._offset},i.prototype.update=function(){this.scale(),t.add(this.position,this.gameObject.transform.position,this.scaled.offset),this.pressedLastFrame=this.pressed,this.pressed=!1,this.mouse.leftButtonPressed&&(this.resolveMouseAndRectangle(),this.resolveMouseAndCircumference()),this.touchEnabled&&this.touch.touching&&(this.resolveTouchAndRectangle(),this.resolveTouchAndCircumference()),this.onClick&&!this.pressedLastFrame&&this.pressed&&this.onClick(),this.onPressed&&this.pressed&&this.onPressed()},i.prototype.scale=function(){this.scaled.width=this.width*this.gameObject.transform.scale.x,this.scaled.height=this.width*this.gameObject.transform.scale.y,this.scaled.offset.x=this._offset.x*this.gameObject.transform.scale.x,this.scaled.offset.y=this._offset.y*this.gameObject.transform.scale.y,this.scaled.radius=this.radius*this.gameObject.transform.scale.magnitude},i.prototype.resolveMouseAndRectangle=function(){this.type===te.Rectangle&&(this.pressed||(this.pressed=n(this.mouse.positionInViewport.x,this.position.x-this.scaled.width/2,this.position.x+this.scaled.width/2)&&n(this.mouse.positionInViewport.y,this.position.y-this.scaled.height/2,this.position.y+this.scaled.height/2)))},i.prototype.resolveMouseAndCircumference=function(){this.type===te.Circumference&&(t.subtract(this.distance,this.position,this.mouse.positionInViewport),this.pressed||(this.pressed=this.distance.magnitude<=this.scaled.radius))},i.prototype.resolveTouchAndRectangle=function(){this.type===te.Rectangle&&(this.pressed||(this.pressed=this.position.x+this.scaled.width/2>=this.touch.positionInViewport.x-this.touch.radius.x&&this.position.x-this.scaled.width/2<=this.touch.positionInViewport.x+this.touch.radius.x&&this.position.y+this.scaled.height/2>=this.touch.positionInViewport.y-this.touch.radius.y&&this.position.y-this.scaled.height/2<=this.touch.positionInViewport.y+this.touch.radius.y))},i.prototype.resolveTouchAndCircumference=function(){this.type===te.Circumference&&(t.subtract(this.distance,this.position,this.touch.positionInViewport),this.pressed||(this.pressed=this.distance.magnitude<=this.scaled.radius+this.touch.radius.x))}}(m);var Re=function(e){function i(){var i=null!==e&&e.apply(this,arguments)||this;return i.mousePressed=!1,i.position=new t,i}return a(i,e),i.prototype.start=function(){this.camera=this.getCurrentScene().gameCamera},i.prototype.update=function(){H.mouse.leftButtonPressed&&!1===this.mousePressed&&(t.round(this.position,t.add(this.position,this.camera.transform.position,t.scale(this.position,H.mouse.positionInViewport,1/this.camera.zoom))),console.log("Space position: {x: ".concat(this.position.x,", y: ").concat(this.position.y,"}"))),this.mousePressed=H.mouse.leftButtonPressed},i}(le);const Se=JSON.parse('{"compressionlevel":-1,"height":22,"infinite":false,"layers":[{"data":[1,2,2,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,3,13,14,14,15,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,13,15,13,14,14,15,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,13,15,13,14,14,15,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,13,15,13,14,14,15,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,45,0,0,0,13,15,13,14,14,15,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,30,15,0,0,0,0,13,15,13,14,14,15,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,30,14,14,15,0,0,0,43,30,15,13,14,14,15,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,30,14,14,14,14,15,0,0,0,0,13,15,13,14,14,15,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,30,14,14,14,14,14,14,28,45,0,0,0,13,15,13,14,14,15,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,30,14,14,14,14,14,14,14,14,15,0,0,0,0,13,15,13,14,14,15,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,30,14,14,14,14,14,14,14,14,14,14,15,0,0,0,43,30,15,13,14,14,15,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,30,14,14,14,14,14,14,14,14,14,14,14,14,15,0,0,0,0,13,15,13,14,14,15,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,30,14,14,14,14,14,14,14,14,14,14,14,14,14,14,28,45,0,0,0,13,15,13,14,14,15,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,30,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,15,0,0,0,0,13,15,13,14,14,15,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,2,2,2,3,0,25,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,27,0,0,0,43,30,15,13,14,14,15,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,30,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,15,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,13,14,14,14,14,15,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,13,15,13,14,14,15,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,30,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,15,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,13,14,14,14,14,28,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,30,15,13,14,14,15,0,0,0,0,0,0,0,0,0,0,0,1,2,30,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,15,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,13,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,15,13,14,14,28,2,2,2,2,2,2,2,2,2,2,2,30,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,28,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,30,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,15,13,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,15,13,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,15,25,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,15],"height":22,"id":1,"name":"Layer1","opacity":1,"type":"tilelayer","visible":true,"width":96,"x":0,"y":0},{"data":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,8,8,9,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,12,20,20,21,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,20,20,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,36,20,20,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,20,20,20,34,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,12,20,20,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,36,20,20,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,20,20,20,10,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,20,20,20,22,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,12,20,20,34,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,7,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,20,20,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,31,20,20,32,12,34,35,36,20,10,11,12,20,35,36,20,10,32,20,35,36,20,10,33,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"height":22,"id":3,"name":"Layer2","opacity":0.7,"type":"tilelayer","visible":true,"width":96,"x":0,"y":0},{"data":[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,463,464,465,466,0,0,0,0,0,463,464,465,466,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,463,464,527,528,529,530,465,466,0,463,464,527,528,529,530,465,466,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,527,528,1313,1235,1235,1305,529,530,459,527,528,1313,1235,1235,1305,529,530,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],"height":22,"id":5,"name":"Hills","opacity":1,"type":"tilelayer","visible":false,"width":96,"x":0,"y":0}],"nextlayerid":6,"nextobjectid":1,"orientation":"orthogonal","renderorder":"right-down","tiledversion":"1.7.2","tileheight":16,"tilesets":[{"firstgid":1,"source":"../../../../Tiled Projects/Mini Platformer/Tileset01.tsx"},{"firstgid":73,"source":"../../../../Tiled Projects/Mini Platformer/brinstar.tsx"}],"tilewidth":16,"type":"map","version":"1.6","width":96}');class Ae extends le{init(){this.layer="Overlayer",this.addComponent(we,{tileset:{image:W.getImage("image/tileset/tileset.png"),tileWidth:16,tileHeight:16,width:12},tiledData:Se,tilemapLayer:"Layer2",tileWidth:16,tileHeight:16,orientation:_.RightDown}),this.transform.scale.set(3,3)}}class Te extends le{init(){this.layer="Foreground",this.transform.scale.set(3,3),this.tilemapRenderer=this.addComponent(we,{tileset:{image:W.getImage("image/tileset/tileset.png"),tileWidth:16,tileHeight:16,width:12},tiledData:Se,tilemapLayer:"Layer1",tileWidth:16,tileHeight:16,orientation:_.RightDown,smooth:!1}),this.addComponent(ye,{tilemapRenderer:this.tilemapRenderer,debug:!0,composite:!0}),this.addComponent(he,{rigidBodyType:Gt.Static,gravity:0}),this.addChild(Ae).transform.innerPosition=new t(0,0)}}class De extends le{constructor(){super(...arguments),this.axis=new t(0,0),this.jump=!1,this.pause=!1}init(){this.keyboard=H.keyboard}update(){this.gamepad=H.gamepad.getGamepad(0),this.updateKeyboard(),this.gamepad&&this.updateGamepad()}updateKeyboard(){this.axis.x=this.keyboard.isPressed("ArrowRight")?1:this.keyboard.isPressed("ArrowLeft")?-1:0,this.axis.y=this.keyboard.isPressed("ArrowUp")?1:this.keyboard.isPressed("ArrowDown")?-1:0,this.jump=this.keyboard.isPressed("Space"),this.pause=this.keyboard.isPressed("KeyP")}updateGamepad(){this.gamepad.dpadAxes.magnitude>0?this.axis.copy(this.gamepad.dpadAxes):this.gamepad.leftStickAxes.magnitude>=.5&&this.axis.set(Math.sign(this.gamepad.leftStickAxes.x),Math.sign(this.gamepad.leftStickAxes.y)),this.jump=this.gamepad.bottomFace||this.jump,this.pause=this.gamepad.start||this.pause}}class Fe extends m{constructor(){super(...arguments),this.gravity=3e3,this.walkSpeed=320,this.jumpSpeed=840,this.grounded=!1,this.velocity=new t(0,0),this.jumping=!1,this.platformCollision=null,this.hillsCollision=null,this.onMovingPlatform=!1}start(){this.bodyCollider=this.getComponent("BodyCollider"),this.feetCollider=this.getComponent("FeetCollider"),this.headCollider=this.getComponent("HeadCollider"),this.rigidBody=this.getComponent(he),this.inputController=this.findGameObject(De),this.rigidBody.gravity=this.gravity,this.gameObject.transform.parentScale=!1}update(){this.platformCollision=this.feetCollider.getCollisionWithLayer("Platform"),this.grounded=this.feetCollider.collidesWithLayer("Foreground")||this.feetCollider.collidesWithLayer("Hills")||this.feetCollider.collidesWithLayer("Enemy")||null!==this.platformCollision,this.hillsCollision=this.bodyCollider.getCollisionWithLayer("Hills"),this.checkForMovingPlatform(),this.walk(),this.jump(),this.headCollider.collidesWithLayer("Foreground")||(this.bodyCollider.height=this.inputController.axis.y<0?8:16,this.bodyCollider.offsetY=this.inputController.axis.y<0?-4:0,this.headCollider.offsetY=this.inputController.axis.y<0?-2:6)}walk(){this.velocity.set(this.inputController.axis.x*this.walkSpeed*(this.hillsCollision?2:1),this.rigidBody.velocity.y),this.rigidBody.velocity=this.velocity}jump(){!0===this.grounded&&!0===this.inputController.jump&&!1===this.jumping&&(this.jumping=!0,this.velocity.set(this.rigidBody.velocity.x,this.jumpSpeed),this.rigidBody.velocity=this.velocity),this.jumping&&(this.jumping=this.inputController.jump)}checkForMovingPlatform(){this.platformCollision&&!this.onMovingPlatform?(this.gameObject.parent=this.platformCollision.gameObject,this.onMovingPlatform=!0):!this.platformCollision&&this.onMovingPlatform&&(this.gameObject.parent=null,this.onMovingPlatform=!1)}}class Ee extends m{start(){this.rigidBody=this.getComponent(he),this.animator=this.getComponent(je),this.movements=this.getComponent(Fe)}update(){this.gameObject.transform.scale.x=0!==this.rigidBody.velocity.x?Math.sign(this.rigidBody.velocity.x)*Math.abs(this.gameObject.transform.scale.x):this.gameObject.transform.scale.x,0!==this.rigidBody.velocity.x&&this.movements.grounded?!this.animator.isPlayingAnimation("PlayerRun")&&this.animator.playAnimation("PlayerRun"):!this.animator.isPlayingAnimation("PlayerIdle")&&this.animator.playAnimation("PlayerIdle")}}class Be extends le{constructor(){super(...arguments),this.grounded=!1}init(){this.layer="Player",this.spriteRenderer=this.addComponent(be,{sprite:new Oe({image:W.getImage("image/player/player-spritesheet.png"),slice:new e(0,64,16,16),smooth:!1}),offset:new t(0,0)}),this.animator=this.addComponent(je,{spriteRenderer:this.spriteRenderer}).addAnimation(new Ce({sprites:[0,16,32,48].map((t=>new Oe({image:W.getImage("image/player/player-spritesheet.png"),smooth:!1,slice:new e(t,64,16,16)}))),framerate:10,loop:!0}),"PlayerIdle").addAnimation(new Ce({sprites:[0,16,32,48,64,80].map((t=>new Oe({image:W.getImage("image/player/player-spritesheet.png"),smooth:!1,slice:new e(t,16,16,16)}))),framerate:10,loop:!0}),"PlayerRun"),this.addComponent(me,{width:8,height:16,physics:!0,debug:!0},"BodyCollider"),this.addComponent(me,{width:6,height:6,offsetY:-6,physics:!1,debug:!0},"FeetCollider"),this.addComponent(me,{width:6,height:4,offsetY:6,physics:!1,debug:!0},"HeadCollider"),this.addComponent(he,{rigidBodyType:Gt.Dynamic}),this.movements=this.addComponent(Fe),this.addComponent(Ee)}start(){this.transform.scale.set(3,3),this.animator.playAnimation("PlayerIdle")}update(){this.spriteRenderer.active=!this.getCurrentScene().paused,this.grounded=this.movements.grounded}}class Ie extends b{constructor(){super(...arguments),this.boundaries={minX:0,maxX:0,minY:0,maxY:0},this.playerOffset=new t,this.cachePosition=new t}start(){this.player=this.findGameObject(Be),this.camera=this.gameObject;const t=this.findGameObject(Te),e=t.getComponent(we);this.boundaries.minX=t.transform.position.x,this.boundaries.maxX=t.transform.position.x+e.realWidth,this.boundaries.maxY=t.transform.position.y,this.boundaries.minY=t.transform.position.y-e.realHeight,this.cachePosition.copy(this.player.transform.position),this.gameObject.transform.position.copy(this.player.transform.position)}update(){this.followPlayer(),this.clampToBoundaries()}followPlayer(){t.subtract(this.playerOffset,this.player.transform.position,this.gameObject.transform.position),this.cachePosition.x=this.player.transform.position.x-i(this.playerOffset.x,-80,80),this.cachePosition.y=this.player.transform.position.y-i(this.playerOffset.y,-80,80),this.gameObject.transform.position=this.cachePosition}clampToBoundaries(){this.gameObject.transform.position.x=i(this.cachePosition.x,this.boundaries.minX+this.camera.viewportRect.width/2,this.boundaries.maxX-this.camera.viewportRect.width/2),this.gameObject.transform.position.y=i(this.cachePosition.y,this.boundaries.minY+this.camera.viewportRect.height/2,this.boundaries.maxY-this.camera.viewportRect.height/2)}}class Ue extends le{constructor(){super(...arguments),this.walkSpeed=96,this.jumpSpeed=840,this.jumping=!0,this.cacheVelocity=new t,this.bodyCollision=!1,this.edgeCollision=!1,this.wallCollision=!1,this.playerCollision=!1}init({position:t,walkSpeed:i}){this.layer="Enemy",this.spriteRenderer=this.addComponent(be,{sprite:new Oe({image:W.getImage("image/enemy/goblin_spritesheet.png"),slice:new e(0,0,16,16),smooth:!1})}),this.animator=this.addComponent(je,{spriteRenderer:this.spriteRenderer}).addAnimation((()=>{const t={image:W.getImage("image/enemy/goblin_spritesheet.png"),smooth:!1};return new Ce({sprites:[0,16,32,48,64,80].map((i=>new Oe(Object.assign(Object.assign({},t),{slice:new e(i,0,16,16)})))),framerate:10,loop:!0})})(),"Walking"),this.bodyCollider=this.addComponent(me,{width:10,height:16,physics:!0,debug:!0},"BodyCollider"),this.edgeCollider=this.addComponent(me,{width:4,height:4,offsetX:8,offsetY:-10,physics:!1,debug:!0},"EdgeCollider"),this.addComponent(he,{rigidBodyType:Gt.Dynamic,gravity:3e3}),this.transform.position=t,this.walkSpeed=i}start(){this.transform.scale.set(3,3),this.animator.playAnimation("Walking")}update(){this.move()}move(){this.bodyCollisions=this.bodyCollider.getCollisionsWithLayer("Foreground"),this.bodyCollision=this.bodyCollisions.length>0,this.edgeCollision=this.edgeCollider.collidesWithLayer("Foreground"),this.playerCollision=this.edgeCollider.collidesWithLayer("Player"),this.wallCollision=this.bodyCollision&&this.bodyCollisions.some((t=>0!==t.resolution.direction.x));let t=this.bodyCollision?0:this.rigidBody.velocity.y;this.edgeCollision&&!this.wallCollision||!this.bodyCollision||(this.transform.scale.x*=-1),this.playerCollision&&!1===this.jumping&&(this.jumping=!0,t=this.jumpSpeed),!1===this.playerCollision&&(this.jumping=!1),this.cacheVelocity.set(Math.sign(this.transform.scale.x)*this.walkSpeed,t),this.rigidBody.velocity=this.cacheVelocity}}const Ge=.1;class Le extends le{init(){this.layer="UI",this.ui=!0,this.addComponent(We),this.addComponent(ke),this.addComponent(Ve)}start(){this.transform.position.set(20-V.gameWidth/2,40-V.gameHeight/2)}}class ke extends x{constructor(){super(...arguments),this.timer=Ge,this.counter=0}init(){this.textRenderer=this.gameObject.addComponent(Me,{width:280,text:"",color:"#A7D6ED",fontSize:14,font:"PressStart2P-Regular",orientation:xt.RightDown,offset:new t(260,0)})}update(){if(this.timer+=Y.physicsDeltaTime,this.counter++,this.timer>=Ge){const t=(1/(this.timer/this.counter)).toFixed(2);this.textRenderer.text=`Physics: ${t} FPS`,this.timer=0,this.counter=0}}}class We extends m{constructor(){super(...arguments),this.timer=Ge,this.counter=0}init(){this.textRenderer=this.gameObject.addComponent(Me,{width:210,text:"",color:"#A7D6ED",fontSize:14,font:"PressStart2P-Regular",orientation:xt.RightDown,smooth:!1})}update(){if(this.timer+=Y.unscaledDeltaTime,this.counter++,this.timer>=Ge){const t=(1/(this.timer/this.counter)).toFixed(2);this.textRenderer.text=`Game: ${t} FPS`,this.timer=0,this.counter=0}}}class Ve extends b{constructor(){super(...arguments),this.timer=Ge,this.counter=0}init(){this.textRenderer=this.gameObject.addComponent(Me,{width:280,text:"",color:"#A7D6ED",fontSize:14,font:"PressStart2P-Regular",orientation:xt.RightDown,offset:new t(580,0)})}update(){if(this.timer+=Y.browserDeltaTime,this.counter++,this.timer>=Ge){const t=(1/(this.timer/this.counter)).toFixed(2);this.textRenderer.text=`Render: ${t} FPS`,this.timer=0,this.counter=0}}}class He extends le{constructor(){super(...arguments),this.direction=1}init(){this.layer="Foreground",this.addComponent(be,{sprite:new Oe({image:W.getImage("image/misc/wooden_plate.png"),smooth:!1}),tiled:new t(3,1),offset:new t(0,0)}),this.addComponent(me,{width:48,height:8,physics:!0,debug:!0,offsetY:4}),this.addComponent(he,{rigidBodyType:Gt.Kinematic}),this.transform.scale.set(3,3),this.transform.position.set(1400,-648)}update(){this.direction=-1,this.transform.rotation.degrees+=100*Y.deltaTime*this.direction}}class ze extends le{init(){this.layer="Parallax",this.addComponent(be,{sprite:new Oe({image:W.getImage("image/scene/background.png"),smooth:!1}),tiled:new t(6,1)}),this.transform.scale.set(4.8,9.6),this.transform.position.set(1512,-500)}}class Ye extends le{init(){this.layer="UI",this.ui=!0,this.addComponent(Me,{text:"PAUSE",color:"#A7D6ED",fontSize:20,font:"PressStart2P-Regular",orientation:xt.Center,width:100})}start(){this.transform.position.set(0,0)}}class Xe extends le{init({spots:t}){this.layer="Platform",this.addComponent(be,{sprite:new Oe({image:W.getImage("image/tileset/tileset.png"),smooth:!1,slice:new e(96,48,48,16)})}),this.addComponent(me,{debug:!0,width:48,height:2,offsetY:7}),this.addComponent(he,{rigidBodyType:Gt.Kinematic}),this.addComponent(Ne,{spots:t}),this.transform.scale.set(3,3)}start(){}}class Ne extends x{constructor(){super(...arguments),this.moveSpeed=150,this.center=new e(0,0,4,4),this.currentSpotIndex=0,this.direction=new t,this.velocity=new t}init({spots:t}){this.spots=t.map((t=>new e(t.x-2,t.y-2,4,4)))}start(){this.currentSpot=this.spots[this.currentSpotIndex],this.gameObject.transform.position=this.currentSpot.center,this.center.position=this.gameObject.transform.position}update(){t.unit(this.direction,t.subtract(this.direction,this.currentSpot.center,this.gameObject.transform.position)),t.add(this.gameObject.transform.position,this.gameObject.transform.position,t.scale(this.velocity,this.direction,this.moveSpeed*Y.physicsDeltaTime)),this.center.position=this.gameObject.transform.position,this.center.overlaps(this.currentSpot)&&(this.gameObject.transform.position=this.currentSpot.center,this.currentSpotIndex=(this.currentSpotIndex+1)%this.spots.length,this.currentSpot=this.spots[this.currentSpotIndex])}}const qe="Use Arrows to move and Space to jump";class Ke extends le{init(){this.layer="UI",this.ui=!0,this.addComponent(Me,{width:14*qe.length,text:qe,color:"#A7D6ED",fontSize:14,font:"PressStart2P-Regular",orientation:xt.RightDown})}start(){this.transform.position.set(20-V.gameWidth/2,70-V.gameHeight/2)}}const $e=new Proxy(new URLSearchParams(window.location.search),{get:(t,e)=>t.get(e.toString())});const Qe="an angry pixel game";class Je extends le{constructor(){super(...arguments),this.timer=0,this.char=0}init(){this.layer="Text",this.textRenderer=this.addComponent(Me,{width:304,height:32,color:"#FFFFFF",text:"",font:"PressStart2P-Regular",fontSize:16,orientation:xt.RightDown,opacity:1}),this.transform.position.set(-152,0)}update(){this.char<Qe.length?this.fillText():this.textRenderer.opacity>0?this.hideText():0===this.textRenderer.opacity&&this.changeScene(),this.timer+=Y.deltaTime}fillText(){this.timer>=.1&&(this.textRenderer.text+=Qe[this.char],this.char++,this.timer=0)}hideText(){this.timer>=.1&&(this.textRenderer.opacity=i(this.textRenderer.opacity-.1,0,1),this.timer=0)}changeScene(){this.timer>=.5&&z.loadScene("Stage01")}}const Ze=new re({containerNode:document.getElementById("app"),gameWidth:1280,gameHeight:720,debugEnabled:!1,canvasColor:"#000000",collisions:{collisionMethod:Ut.SAT,collisionMatrix:[["Player","Foreground"],["Player","Enemy"],["Player","Platform"],["Player","Hills"],["Enemy","Foreground"],["Enemy","Player"],["Enemy","Platform"],["Enemy","Hills"]]}});Ze.addScene(class extends pe{init(){W.loadImage("image/tileset/tileset.png"),W.loadImage("image/player/player-spritesheet.png"),W.loadImage("image/enemy/goblin_spritesheet.png"),W.loadImage("image/misc/wooden_plate.png"),W.loadImage("image/scene/background.png"),W.loadFont("PressStart2P-Regular","font/PressStart2P-Regular.ttf")}update(){W.getAssetsLoaded()&&z.loadScene("Intro")}},"Loading"),Ze.addScene(class extends pe{init(){this.gameCamera.layers=["Text"],this.addGameObject(Je)}},"Intro"),Ze.addScene(class extends pe{constructor(){super(...arguments),this.pauseKey=!1,this.pausing=!1,this.paused=!1,this.enemies=[]}init(){var e;this.addGameObject(De),this.addGameObject(Re),this.addGameObject(Te),this.addGameObject(He),this.addGameObject(Xe,{spots:[new t(1992,-688),new t(1992,-824),new t(2448,-824)]}),this.addGameObject(Xe,{spots:[new t(2184,-688),new t(2948,-688)]}),this.addGameObject(ze),this.player=this.addGameObject(Be),this.player.transform.position.set(s(240,2720),-600);for(let i=1;i<=Number(null!==(e=$e.enemies)&&void 0!==e?e:10);i++)this.enemies.push(this.addGameObject(Ue,{position:new t(s(240,2720),-400),walkSpeed:s(160,340)/100*60}));this.pauseText=this.addGameObject(Ye),this.pauseText.active=!1,this.addGameObject(Le),this.addGameObject(Ke)}start(){this.gameCamera.layers=["Foreground","Hills","Platform","Enemy","Player","Overlayer","QuadTree","UI"],this.gameCamera.zoom=1,this.gameCamera.addComponent(Ie),this.fxCamera=this.gameCamera.addChild(ue),this.fxCamera.layers=["Parallax"],this.fxCamera.zoom=.6,this.fxCamera.depth=-1}update(){this.pause();new t}cameraFX(){this.gameCamera.zoom<1&&(this.gameCamera.zoom+=.1*Y.deltaTime),this.fxCamera.zoom<.6&&(this.fxCamera.zoom+=.1*Y.deltaTime)}pause(){this.pauseKey=this.findGameObject(De).pause,this.pauseKey&&!1===this.pausing&&(this.pausing=!0,Y.setTimeScale(0===Y.getTimeScale()?1:0),this.paused=0===Y.getTimeScale(),this.pauseText.active=this.paused),this.pausing&&(this.pausing=this.pauseKey)}},"Stage01"),Ze.run()})();